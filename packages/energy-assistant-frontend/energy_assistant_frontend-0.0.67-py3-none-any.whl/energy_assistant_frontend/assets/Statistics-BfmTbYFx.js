import{B as b,C as M,c as D,q as w,t as u,w as o,m as e,G as i,S as H,I as d,E as v,M as $,H as g,J as s,$ as f,r as h,P as U,o as Y,R as V,V as q,K as z,F as G}from"./index-Cp3-A7ao.js";import{_ as J,P as K}from"./PowerFlowCard-jNGeIg9r.js";import{C as E,h as F,p as N,f as P,B as W,j as x,L as j,k as I}from"./index-CoXvh_-d.js";import{f as S}from"./utils-D98hIld_.js";import{V as R,a as B,b as T}from"./VCard-D5wKeDng.js";import{n as L}from"./transition-BAtvBeuS.js";import{V as O,a as Q}from"./VToolbar-jYZfQvPG.js";import{V as X,a as C}from"./VTabs-BNyjYrDB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VImg-tOz2PgiP.js";import"./index-DkrqsE6v.js";import"./VBtn-DJBHxlTa.js";import"./forwardRefs-o1fhiqtU.js";import"./VProgressCircular-DvjORuMu.js";import"./resizeObserver-BoHHG32A.js";import"./scopeId-BFshC2jm.js";import"./VSlideGroup-BrMBqUtb.js";const Z={class:""},ee={class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},ae={class:"text-left"},te={class:"float-right"},se={key:0,class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},ne=b({__name:"DeviceEnergyCard",props:{measurement:{},device:{},statistics:{},timeframe:{}},setup(y){const{t:a,d:m}=M(),r=y,_=D(()=>r.measurement.consumed_energy!=0?100*r.measurement.solar_consumed_energy/r.measurement.consumed_energy:0),c=D(()=>r.statistics?{labels:r.statistics.map(n=>m(new Date(n.measurement_date),{month:"numeric",day:"numeric"})),datasets:[{label:"Consumption",backgroundColor:"#2563eb",data:r.statistics.map(n=>{const t=n.device_measurements.find(l=>l.device_id==r.device.id);return t?t.consumed_energy:0})}]}:{labels:[],datasets:[]}),p={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}};return E.register(F,N,P,W,x,j),(n,t)=>(u(),w(T,{class:"elevation-2 ma-4 pa-4 w-80 rounded-md sm:w-96"},{default:o(()=>[e(R,null,{default:o(()=>[i("span",{class:H(["mdi pr-2",n.device.icon])},null,2),i("span",Z,d(n.device.name),1)]),_:1}),e(B,null,{default:o(()=>[i("div",ee,[i("div",ae,[g(d(s(a)("consumption"))+" ",1),i("span",te,d(s(S)(n.measurement.consumed_energy,"kWh")),1)]),e(J,{"self-sufficiency":_.value,"consumed-energy":n.measurement.consumed_energy,"consumed-solar-energy":n.measurement.solar_consumed_energy},null,8,["self-sufficiency","consumed-energy","consumed-solar-energy"])]),n.timeframe=="week"||n.timeframe=="month"?(u(),v("div",se,[e(s(I),{data:c.value,options:p},null,8,["data"])])):$("",!0)]),_:1})]),_:1}))}}),oe=b({__name:"WeeklyStatistics",props:{data:{}},setup(y){const{d:a}=M(),m=D(()=>({labels:_.data.map(c=>a(new Date(c.measurement_date),{month:"numeric",day:"numeric"})),datasets:[{label:"Solar Production",backgroundColor:"#fbbf24",data:_.data.map(c=>c.solar_produced_energy)},{label:"Consumption",backgroundColor:"#2563eb",data:_.data.map(c=>c.consumed_energy)}]})),r={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}};E.register(F,N,P,W,x,j);const _=y;return(c,p)=>(u(),w(s(I),{data:m.value,options:r},null,8,["data"]))}}),re=b({__name:"WeeklyStatisticsCard",props:{data:{}},setup(y){return(a,m)=>(u(),w(T,{class:"elevation-2 ma-4 pa-4 w-80 rounded-md sm:w-96"},{default:o(()=>[e(B,{class:"h-100 w-auto"},{default:o(()=>[e(oe,{data:a.data},null,8,["data"])]),_:1})]),_:1}))}}),le={class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},ie={class:"text-left"},ue={class:"float-right"},de={class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},ce={class:"text-left"},me={class:"float-right"},pe=b({__name:"EnergyConsumptionCard",props:{selfSufficiency:{},selfConsumption:{}},setup(y){return(a,m)=>(u(),w(T,{class:"elevation-2 ma-4 pa-4 w-80 rounded-md sm:w-96"},{default:o(()=>[e(R,null,{default:o(()=>[g(d(s(f)("consumption")),1)]),_:1}),e(B,null,{default:o(()=>[i("div",le,[i("div",ie,[g(d(s(f)("self_sufficiency"))+" ",1),i("span",ue,d(s(S)(a.selfSufficiency,"%")),1)]),e(L,{color:"sun",height:"15",rounded:"","model-value":a.selfSufficiency},null,8,["model-value"])]),i("div",de,[i("div",ce,[g(d(s(f)("self_consumption"))+" ",1),i("span",me,d(s(S)(a.selfConsumption,"%")),1)]),e(L,{color:"grid",height:"15",rounded:"","model-value":a.selfConsumption},null,8,["model-value"])])]),_:1})]),_:1}))}}),_e={class:"flex min-h-screen w-full justify-center"},fe={key:0,class:"grid w-full grid-cols-1 justify-items-center"},ge={key:1},ve={key:0,class:"grid grid-cols-1 p-4 lg:grid-cols-2"},Pe=b({__name:"Statistics",setup(y){const a=h(),m=h(),r=h(!1),_=h(0),c=h(0),p=h("today");U(p,()=>{const t=new Date;switch(p.value){case"week":t.setDate(t.getDate()-7);break;case"month":t.setMonth(t.getMonth()-1);break;case"year":t.setFullYear(t.getFullYear()-1);break}console.log("Load "+t.toString()),n(t)}),Y(()=>{n(new Date)});const n=async function(t){r.value=!0;const l=(await V.getHomeMeasurementDifference(t,new Date)).data;a.value=l,_.value=(1-l.grid_imported_energy/l.consumed_energy)*100,c.value=(l.consumed_energy-l.grid_imported_energy)/l.solar_produced_energy*100,m.value=await V.getDailyMeasurements(t,new Date),r.value=!1};return(t,l)=>(u(),v("div",null,[e(O,{color:"transparent",title:s(q)("bp4")?s(f)("app.statistics"):""},{append:o(()=>[e(X,{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=k=>p.value=k),"align-tabs":"end",height:"100%"},{default:o(()=>[e(C,{value:"today"},{default:o(()=>[g(d(s(f)("period.today")),1)]),_:1}),e(C,{value:"week"},{default:o(()=>[g(d(s(f)("period.week")),1)]),_:1}),e(C,{value:"month"},{default:o(()=>[g(d(s(f)("period.month")),1)]),_:1}),e(C,{value:"year"},{default:o(()=>[g(d(s(f)("period.year")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["title"]),e(Q),i("div",_e,[r.value?(u(),v("div",fe,l[1]||(l[1]=[i("span",{class:"loading loading-dots loading-lg py-2"},null,-1)]))):(u(),v("div",ge,[a.value?(u(),v("div",ve,[e(K,{"home-consumption-power":a.value.consumed_energy,"solar-power":a.value.solar_produced_energy,"grid-imported-energy":a.value.grid_imported_energy,"grid-exported-energy":a.value.grid_exported_energy,unit:"kWh"},null,8,["home-consumption-power","solar-power","grid-imported-energy","grid-exported-energy"]),e(pe,{"self-sufficiency":_.value,"self-consumption":c.value},null,8,["self-sufficiency","self-consumption"]),p.value=="week"&&m.value!=null?(u(),w(re,{key:0,data:m.value},null,8,["data"])):$("",!0),(u(!0),v(z,null,G(a.value.device_measurements,(k,A)=>(u(),v("div",{key:A},[e(ne,{measurement:k,device:s(V).getDeviceInfo(k.device_id),statistics:m.value,timeframe:p.value},null,8,["measurement","device","statistics","timeframe"])]))),128))])):$("",!0)]))])]))}});export{Pe as default};
