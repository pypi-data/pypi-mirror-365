name: Comprehensive Validation Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  comprehensive-tests:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch' || (github.event_name == 'pull_request' && contains(github.event.pull_request.labels.*.name, 'comprehensive-test'))

    steps:
    - uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v5
      with:
        version: "latest"

    - name: Set up Python
      run: uv python install

    - name: Install dependencies
      run: uv sync

    - name: Run comprehensive validation tests
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      run: |
        if [ -z "$GEMINI_API_KEY" ]; then
          echo "::warning::GEMINI_API_KEY not configured in repository secrets"
          echo "::warning::Skipping comprehensive validation tests"
          exit 0
        fi
        ./scripts/run-comprehensive-tests.sh
      timeout-minutes: 10
