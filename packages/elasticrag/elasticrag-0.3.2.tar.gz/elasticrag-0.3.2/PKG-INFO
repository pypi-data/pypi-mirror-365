Metadata-Version: 2.4
Name: elasticrag
Version: 0.3.2
Summary: Elasticsearch-based RAG system with ingest pipeline processing
Project-URL: Homepage, https://github.com/lloydzhou/elasticrag
Project-URL: Repository, https://github.com/lloydzhou/elasticrag
Project-URL: Documentation, https://github.com/lloydzhou/elasticrag#readme
Project-URL: Issues, https://github.com/lloydzhou/elasticrag/issues
Author-email: Lloyd Zhou <lloydzhou@gmail.com>
License: MIT
Keywords: elasticsearch,embedding,nlp,rag,vector-search
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Database :: Database Engines/Servers
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Requires-Python: >=3.8
Requires-Dist: aiohttp>=3.10.11
Requires-Dist: elasticsearch>=8.0.0
Requires-Dist: python-dotenv>=1.0.0
Provides-Extra: all
Requires-Dist: black>=23.0.0; extra == 'all'
Requires-Dist: gradio>=4.44.1; extra == 'all'
Requires-Dist: isort>=5.12.0; extra == 'all'
Requires-Dist: pandas>=1.3.0; extra == 'all'
Requires-Dist: pytest-asyncio>=0.21.0; extra == 'all'
Requires-Dist: pytest>=7.0.0; extra == 'all'
Provides-Extra: dev
Requires-Dist: black>=23.0.0; extra == 'dev'
Requires-Dist: isort>=5.12.0; extra == 'dev'
Requires-Dist: pytest-asyncio>=0.21.0; extra == 'dev'
Requires-Dist: pytest>=7.0.0; extra == 'dev'
Provides-Extra: web
Requires-Dist: gradio>=4.44.1; extra == 'web'
Requires-Dist: pandas>=1.3.0; extra == 'web'
Description-Content-Type: text/markdown

# ElasticRAG

ElasticRAG æ˜¯ä¸€ä¸ªåŸºäº Elasticsearch çš„ RAGï¼ˆRetrieval-Augmented Generationï¼‰ç³»ç»Ÿï¼Œå……åˆ†åˆ©ç”¨ Elasticsearch çš„ ingest pipeline åŠŸèƒ½æ¥å¤„ç†æ•´ä¸ª RAG å·¥ä½œæµã€‚

## ç‰¹æ€§

- ğŸ” åŸºäº Elasticsearch çš„å‘é‡æœç´¢å’Œæ–‡æœ¬æœç´¢
- ğŸ› ï¸ ä½¿ç”¨ ingest pipeline è¿›è¡Œæ–‡æ¡£å¤„ç†å’Œå‘é‡åŒ–
- ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒå’Œè®¤è¯
- ğŸ§  å¤šæ¨¡å‹æ”¯æŒï¼ˆOpenAIã€HuggingFace ç­‰ï¼‰
- ğŸ“š çŸ¥è¯†åº“ï¼ˆCollectionï¼‰ç®¡ç†
- ğŸ”„ æ··åˆæœç´¢å’Œ RRFï¼ˆReciprocal Rank Fusionï¼‰ç®—æ³•
- ğŸ“„ æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼çš„æ–‡æœ¬åˆ†å‰²
- âš™ï¸ æ”¯æŒç¯å¢ƒå˜é‡é…ç½®å’Œå‘½ä»¤è¡Œå‚æ•°
- ğŸŒ å¯é€‰çš„ Web ç®¡ç†ç•Œé¢
- âœ¨ **æ–°å¢**: é€šè¿‡çŸ¥è¯†å›¾è°±å’Œæœ¯è¯­åº“è¿›è¡Œå¢å¼ºæ£€ç´¢

## å¢å¼ºæ£€ç´¢ï¼šç»“åˆçŸ¥è¯†å›¾è°±ä¸æœ¯è¯­åº“

ElasticRAG æ”¯æŒé€šè¿‡é›†æˆçŸ¥è¯†å›¾è°±å®ä½“å’Œæœ¯è¯­åº“æ¥å¢å¼ºç”¨æˆ·æŸ¥è¯¢ï¼Œä»è€Œå®ç°æ›´é«˜çº§çš„æ£€ç´¢ç­–ç•¥ã€‚è¿™ç§æ··åˆæ–¹æ³•ç»“åˆäº†è¯æ³•æœç´¢ã€è¯­ä¹‰æœç´¢å’Œç»“æ„åŒ–çŸ¥è¯†ï¼Œä»¥è·å¾—æ›´å‡†ç¡®ã€æ›´ç›¸å…³çš„ç»“æœã€‚

### å·¥ä½œåŸç†

`Collection` ç±»ä¸­çš„ `query` æ–¹æ³•å¯ä»¥é€šè¿‡ä»¥ä¸‹å¯é€‰å‚æ•°è¿›è¡Œå¢å¼ºï¼š

-   `k_hop_entities`: ä¸€ä¸ªåˆ—è¡¨çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºä»ç”¨æˆ·æŸ¥è¯¢ä¸­æå–çš„å®ä½“çš„ k-hop é‚»å±…ã€‚ä¾‹å¦‚ï¼š`[['å®ä½“_A1', 'å®ä½“_A2'], ['å®ä½“_B1']]`ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªåˆ—è¡¨åŒ…å« 1-hop é‚»å±…ï¼Œç¬¬äºŒä¸ªåˆ—è¡¨åŒ…å« 2-hop é‚»å±…ã€‚
-   `terminology`: ä¸æŸ¥è¯¢ç›¸å…³çš„æœ¯è¯­æˆ–åŒä¹‰è¯åˆ—è¡¨ã€‚

è¿™äº›å‚æ•°ç”¨äºæ„å»ºä¸€ä¸ªå¢å¼ºæŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢é€šè¿‡ä¸¤ç§æ–¹å¼è¿ä½œï¼š

1.  **æ–‡æœ¬æœç´¢å¢å¼º**:
    *   **æœ¯è¯­åº“**: ä½¿ç”¨ `match_phrase_prefix` æŸ¥è¯¢æŸ¥æ‰¾åŒ…å«ç›¸å…³æœ¯è¯­çš„æ–‡æ¡£ã€‚è¿™å¯¹äºåŒä¹‰è¯å’ŒæŠ€æœ¯æœ¯è¯­éå¸¸æœ‰ç”¨ã€‚
    *   **å®ä½“**: ä½¿ç”¨ `terms` æŸ¥è¯¢åŒ¹é…å…¶æ–‡æœ¬å—åŒ…å«æ‰€æä¾› k-hop å®ä½“çš„æ–‡æ¡£ã€‚ç›¸å…³æ€§å¾—åˆ†ï¼ˆ`boost`ï¼‰ä¼šéšç€è·³æ•°çš„å¢åŠ è€Œè¡°å‡ï¼Œä»è€Œç»™äºˆæ›´è¿‘çš„å®ä½“æ›´é«˜çš„æƒé‡ã€‚

2.  **å‘é‡æœç´¢å¢å¼º**:
    *   æœ¯è¯­å’Œå®ä½“ä¸åŸå§‹æŸ¥è¯¢æ–‡æœ¬ä¸€èµ·è¢«æ ¼å¼åŒ–ä¸ºä¸€ä¸ªç»“æ„åŒ–çš„æç¤ºï¼ˆPromptï¼‰ã€‚
    *   è¿™ä¸ªå¢å¼ºçš„æç¤ºéšåè¢«è½¬æ¢ä¸ºç”¨äº KNN æœç´¢çš„åµŒå…¥å‘é‡ã€‚è¿™ä¸°å¯Œäº†æŸ¥è¯¢çš„è¯­ä¹‰ä¸Šä¸‹æ–‡ï¼Œä»è€Œå®ç°æ›´å¥½çš„ç›¸ä¼¼åº¦åŒ¹é…ã€‚

### çµæ´»çš„æƒé‡é…ç½®

æœ¯è¯­å’Œå®ä½“å¯¹æ–‡æœ¬æœç´¢å¾—åˆ†çš„å½±å“å¯ä»¥é€šè¿‡ `query` æ–¹æ³•ä¸­çš„ `boost_config` å‚æ•°è¿›è¡Œè‡ªå®šä¹‰ã€‚è¯¥å­—å…¸å¯ä»¥åŒ…å«ï¼š

-   `terminology_boost`: æœ¯è¯­åŒ¹é…çš„æƒé‡ï¼ˆé»˜è®¤å€¼ï¼š`0.6`ï¼‰ã€‚
-   `entity_base_boost`: 1-hop å®ä½“åŒ¹é…çš„åŸºç¡€æƒé‡ï¼ˆé»˜è®¤å€¼ï¼š`0.4`ï¼‰ã€‚
-   `entity_decay_factor`: åç»­è·³æ•°çš„è¡°å‡å› å­ï¼ˆé»˜è®¤å€¼ï¼š`0.6`ï¼‰ã€‚

### æ•°æ®å‡†å¤‡

è¦åˆ©ç”¨åŸºäºå®ä½“çš„æ£€ç´¢ï¼Œæ‚¨å¿…é¡»åœ¨æ•°æ®æ‘„å…¥è¿‡ç¨‹ä¸­ä»æ–‡æ¡£ä¸­æå–å®ä½“ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨æ¯ä¸ªæ–‡æœ¬å—çš„ `metadata.entities` å­—æ®µä¸­ã€‚è¿™é€šå¸¸éœ€è¦åœ¨è°ƒç”¨ `collection.add()` ä¹‹å‰ä½¿ç”¨å‘½åå®ä½“è¯†åˆ«ï¼ˆNERï¼‰æ¨¡å‹æ¥å®Œæˆã€‚

## å®‰è£…

### åŸºç¡€å®‰è£…

ä»…å®‰è£…æ ¸å¿ƒåŠŸèƒ½ï¼ˆCLI å‘½ä»¤è¡Œå·¥å…·ï¼‰ï¼š

```bash
uv add elasticrag
```

### å®Œæ•´å®‰è£…

åŒ…å« Web ç®¡ç†ç•Œé¢ï¼š

```bash
uv add 'elasticrag[web]'
```

### å¼€å‘å®‰è£…

åŒ…å«å¼€å‘å·¥å…·ï¼š

```bash
uv add 'elasticrag[dev]'
```

### å…¨éƒ¨å®‰è£…

åŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼š

```bash
uv add 'elasticrag[all]'
```

### ä»æºç å®‰è£…

```bash
git clone <repository-url>
cd elasticrag
uv sync
# æˆ–å®‰è£…åŒ…å« web ç•Œé¢
uv sync --extra web
```

## é…ç½®

### ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆä» `.env.example` å¤åˆ¶ï¼‰ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# Elasticsearch Configuration
ELASTICSEARCH_HOST=http://localhost:9200

# Authentication
ELASTICRAG_USERNAME=your_username
ELASTICRAG_API_KEY=your_api_key

# Text Embedding Service
TEXT_EMBEDDING_URL=http://your-embedding-service:8080/embed
TEXT_EMBEDDING_API_KEY=your_embedding_api_key
```

### å‘½ä»¤è¡Œå‚æ•°

ä½ ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è¦†ç›–ç¯å¢ƒå˜é‡ï¼š

```bash
elasticrag --host localhost:9200 -u admin -k secret setup
```

## å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–ç³»ç»Ÿ

```bash
elasticrag setup
```

### 2. å¯åŠ¨ Web ç®¡ç†ç•Œé¢ï¼ˆå¯é€‰ï¼‰

âš ï¸ **æ³¨æ„**: Web ç•Œé¢éœ€è¦é¢å¤–å®‰è£… gradio ä¾èµ–ï¼š

```bash
# å®‰è£… web ä¾èµ–
uv add 'elasticrag[web]'

# å¯åŠ¨ web ç•Œé¢
elasticrag server --port 7860
```

ç„¶åè®¿é—® http://localhost:7860 è¿›å…¥ç®¡ç†ç•Œé¢ã€‚

é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼š
- ç”¨æˆ·å: admin
- å¯†ç : admin123

### 3. ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

```bash
# åˆ—å‡ºå¯ç”¨æ¨¡å‹
elasticrag list-models

# æ·»åŠ æ–‡æ¡£
elasticrag add document.pdf -c my_collection -m my_model

# æœç´¢æ–‡æ¡£
elasticrag search "your query" -c my_collection -m my_model -s 10
```

ä½ ä¹Ÿå¯ä»¥åœ¨æœç´¢æ—¶åŠ å…¥çŸ¥è¯†å›¾è°±å’Œæœ¯è¯­åº“å‚æ•°ï¼ˆæ³¨æ„ï¼šCLIå½“å‰ä¸æ”¯æŒå¤æ‚æ•°æ®ç»“æ„ï¼Œæ­¤åŠŸèƒ½ä¸»è¦é€šè¿‡APIä½¿ç”¨ï¼‰ï¼š

```python
# API è°ƒç”¨ç¤ºä¾‹
results = await collection.query(
    query_text="ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ",
    terminology=["AI", "äººå·¥æ™ºèƒ½"],
    k_hop_entities=[
        ["æ·±åº¦å­¦ä¹ ", "ç¥ç»ç½‘ç»œ"],  # 1-hop
        ["TensorFlow", "PyTorch"]              # 2-hop
    ],
    boost_config={
        "terminology_boost": 0.7,
        "entity_base_boost": 0.5,
        "entity_decay_factor": 0.5
    }
)
```

## CLI å‘½ä»¤å‚è€ƒ

### å…¨å±€é€‰é¡¹

- `--host`: Elasticsearch ä¸»æœºåœ°å€
- `-u, --username`: ç”¨æˆ·å
- `-k, --api-key`: API å¯†é’¥
- `-v, --verbose`: å¯ç”¨è¯¦ç»†æ—¥å¿—

### å‘½ä»¤

- `setup`: åˆå§‹åŒ–ç³»ç»Ÿ
- `server`: å¯åŠ¨ Gradio Web ç®¡ç†ç•Œé¢ **ï¼ˆéœ€è¦å®‰è£… web ä¾èµ–ï¼‰**
- `list-models`: åˆ—å‡ºå¯ç”¨æ¨¡å‹
- `list-users`: åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
- `list-collections`: åˆ—å‡ºæ‰€æœ‰é›†åˆ
- `list-documents [collection] [model]`: åˆ—å‡ºæ–‡æ¡£
- `add <file_path> [-c collection] [-m model]`: æ·»åŠ æ–‡æ¡£
- `search <query> [-c collection] [-m model] [-s size]`: æœç´¢æ–‡æ¡£

#### server å‘½ä»¤é€‰é¡¹

âš ï¸ **æ³¨æ„**: server å‘½ä»¤éœ€è¦å®‰è£…é¢å¤–ä¾èµ–ï¼š

```bash
uv add 'elasticrag[web]'
```

ç„¶åå¯ä»¥ä½¿ç”¨ï¼š

```bash
elasticrag server [é€‰é¡¹]

é€‰é¡¹:
  --port PORT           Webç•Œé¢ç«¯å£ (é»˜è®¤: 7860)
  --host HOST           Webç•Œé¢ä¸»æœº (é»˜è®¤: 0.0.0.0)
  --share               é€šè¿‡ Gradio åˆ›å»ºå…¬å…±é“¾æ¥
  --admin-username USER ç®¡ç†å‘˜ç”¨æˆ·å
  --admin-password PASS ç®¡ç†å‘˜å¯†ç 
```

## ä¾èµ–è¯´æ˜

### æ ¸å¿ƒä¾èµ–

- `elasticsearch>=8.0.0`: Elasticsearch å®¢æˆ·ç«¯
- `python-dotenv>=1.0.0`: ç¯å¢ƒå˜é‡ç®¡ç†
- `aiohttp>=3.10.11`: å¼‚æ­¥ HTTP å®¢æˆ·ç«¯

### å¯é€‰ä¾èµ–

#### Web ç•Œé¢ (`elasticrag[web]`)

- `gradio>=4.0.0`: Web ç•Œé¢æ¡†æ¶
- `pandas>=1.3.0`: æ•°æ®å¤„ç†

#### å¼€å‘å·¥å…· (`elasticrag[dev]`)

- `pytest>=7.0.0`: æµ‹è¯•æ¡†æ¶
- `pytest-asyncio>=0.21.0`: å¼‚æ­¥æµ‹è¯•æ”¯æŒ
- `black>=23.0.0`: ä»£ç æ ¼å¼åŒ–
- `isort>=5.12.0`: å¯¼å…¥æ’åº

## Web ç®¡ç†ç•Œé¢

### å®‰è£… Web ä¾èµ–

```bash
uv add 'elasticrag[web]'
```

### ç®¡ç†å‘˜åŠŸèƒ½

ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•åå¯ä»¥ï¼š

- **ç”¨æˆ·ç®¡ç†**: æŸ¥çœ‹ã€æ·»åŠ ã€åˆ é™¤ç”¨æˆ·
- **æ¨¡å‹ç®¡ç†**: æŸ¥çœ‹ã€æ·»åŠ æ¨¡å‹é…ç½®
- **ç³»ç»Ÿç›‘æ§**: æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€å’Œèµ„æºä½¿ç”¨

### ç”¨æˆ·åŠŸèƒ½

ä½¿ç”¨æ™®é€šç”¨æˆ·è´¦æˆ·ç™»å½•åå¯ä»¥ï¼š

- **é›†åˆç®¡ç†**: æŸ¥çœ‹è‡ªå·±çš„æ–‡æ¡£é›†åˆ
- **æ–‡æ¡£ç®¡ç†**: æ·»åŠ ã€åˆ é™¤ã€æŸ¥çœ‹æ–‡æ¡£
- **æœç´¢è°ƒè¯•**: åœ¨é›†åˆä¸­æœç´¢æ–‡æ¡£å¹¶æŸ¥çœ‹ç»“æœ

### ç¯å¢ƒå˜é‡é…ç½®

Web ç•Œé¢ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼š

```bash
# ç®¡ç†å‘˜è´¦æˆ·é…ç½®
ELASTICRAG_ADMIN_USERNAME=admin
ELASTICRAG_ADMIN_PASSWORD=admin123
```

## API ä½¿ç”¨

```python
from elasticrag import Client

# åˆ›å»ºå®¢æˆ·ç«¯
client = Client('http://localhost:9200')

# è®¤è¯ç”¨æˆ·
user = client.authenticate('username', 'api_key')

# è·å–é›†åˆ
collection = client.get_collection('my_collection', 'my_model')

# æ·»åŠ æ–‡æ¡£
collection.add('doc_id', 'Document Name', text_content='Your content here')

# æœç´¢
results = await collection.query('your query')

# ä½¿ç”¨çŸ¥è¯†å›¾è°±å’Œæœ¯è¯­åº“è¿›è¡Œå¢å¼ºæœç´¢
kg_results = await collection.query(
    query_text='your query',
    terminology=['term1', 'term2'],
    k_hop_entities=[['entity1'], ['entity2']],
    boost_config={'terminology_boost': 0.8}
)
```

## å¼€å‘

```bash
# å®‰è£…å¼€å‘ä¾èµ–
uv sync --extra dev

# å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬ webï¼‰
uv sync --extra all

# è¿è¡Œæµ‹è¯•
uv run pytest

# è¿è¡Œå¼‚æ­¥æµ‹è¯•ï¼ˆä½¿ç”¨ anyioï¼‰
uv run pytest tests/ -v

# ä»£ç æ ¼å¼åŒ–
uv run black .
uv run isort .
```

### æµ‹è¯•æ¡†æ¶

é¡¹ç›®ä½¿ç”¨ `pytest-asyncio` è¿›è¡Œå¼‚æ­¥æµ‹è¯•ã€‚è¿™å…è®¸ `pytest` ç›´æ¥è¿è¡Œ `async def` æµ‹è¯•å‡½æ•°ã€‚

- **äº‹ä»¶å¾ªç¯ç®¡ç†**: `pytest-asyncio` ä¸ºæ¯ä¸ªæµ‹è¯•å‡½æ•°åˆ›å»ºå¹¶ç®¡ç†ç‹¬ç«‹çš„äº‹ä»¶å¾ªç¯ï¼Œç¡®ä¿æµ‹è¯•ä¹‹é—´çš„éš”ç¦»ã€‚
- **å¼‚æ­¥ Fixtures**: æ”¯æŒ `async def` fixturesï¼Œå¯ä»¥æ–¹ä¾¿åœ°è®¾ç½®å’Œæ¸…ç†å¼‚æ­¥èµ„æºã€‚

æµ‹è¯•å‘½ä»¤ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
uv run pytest tests/ -v

# è¿è¡Œç‰¹å®šçš„å¼‚æ­¥æµ‹è¯•
uv run pytest tests/test_enhanced_query.py::TestQueryExecution::test_query_basic -v

# å¯ç”¨è¯¦ç»†è¾“å‡º
uv run pytest tests/ -v -s
```

## è®¸å¯è¯

MIT License
