"""
Defines the Vulnerability model for representing vulnerabilities.
"""

from typing import Any, Iterable, Optional, Tuple

from pydantic import BaseModel, ConfigDict, Field, field_validator

from vexipy._iri import Iri


class Vulnerability(BaseModel):
    """
    Represents a vulnerability with optional aliases and description.

    :param id: The unique identifier for the vulnerability (in IRI form).
    :param name: The name of the vulnerability.
    :param description: A description of the vulnerability.
    :param aliases: Aliases for the vulnerability.
    """

    id: Optional[Iri] = Field(alias="@id", default=None)
    name: str
    description: Optional[str] = None
    aliases: Optional[Tuple[str, ...]] = None

    model_config = ConfigDict(frozen=True, populate_by_name=True)

    @field_validator("aliases", mode="before")
    @classmethod
    def convert_to_tuple(cls, v: Optional[Iterable[str]]) -> Optional[Tuple[str, ...]]:
        """
        Converts an optional iterable parameter to a tuple.

        :param v: Iterable of strings or None.
        :return: Tuple of aliases or None if not provided.
        """
        return None if v is None else tuple(v)

    def update(self, **kwargs: Any) -> "Vulnerability":
        """
        Returns a new Vulnerability instance with updated fields.

        :param kwargs: Fields to update in the model.
        :return: Updated Vulnerability instance.
        """
        obj = self.model_dump()
        obj.update(kwargs)
        return Vulnerability(**obj)

    def to_json(self, **kwargs: Any) -> str:
        """
        Serializes the Vulnerability model to a JSON string.

        :param kwargs: Additional keyword arguments for serialization with Pydantic's model_dump_json.
        :return: JSON string representation of the model.
        """
        return self.model_dump_json(**kwargs)

    @classmethod
    def from_json(cls, json_string: str) -> "Vulnerability":
        """
        Creates a Vulnerability instance from a JSON string.

        :param json_string: JSON string to deserialize.
        :return: Vulnerability instance.
        """
        return cls.model_validate_json(json_string)
