from pathlib import Path

import httpx
import pytest
from kurra.db import sparql, upload
from rdflib import Graph
from rdflib.compare import isomorphic
from typer.testing import CliRunner

from prezmanifest.cli import app
from prezmanifest.labeller import LabellerOutputTypes, label
from tests.fuseki.conftest import fuseki_container

runner = CliRunner()


def test_label_iris():
    with pytest.raises(ValueError):
        label(
            Path(__file__).parent / "demo-vocabs/manifest-labels-none.ttl",
            output_type="x",
        )

    iris = label(
        Path(__file__).parent / "semback/cat-01/manifest.ttl",
        output_type=LabellerOutputTypes.iris,
    )

    assert len(iris) == 45


def test_label_rdf():
    with pytest.raises(ValueError):
        label(
            Path(__file__).parent / "demo-vocabs/manifest-labels-none.ttl",
            output_type="x",
        )

    iris = label(
        Path(__file__).parent / "semback/cat-01/manifest.ttl",
        output_type=LabellerOutputTypes.iris,
        additional_context="https://fuseki.dev.kurrawong.ai/semback/",
        http_client=httpx.Client(auth=("kn", "kn"))
    )

    assert len(iris) == 45