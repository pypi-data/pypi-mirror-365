import{P as z,Q as oe,L as P,m as T,g as r,K as X,r as ne,l as M,o as m,F as O,E as ie,H as A,e as L,c as D,p as Q,a,f as V,t as B,n as H,b as W,h as F,w as f,j as K,q as se}from"./index-BA5nENc7.js";import{_ as re,V as ue,a as me}from"./ConnectedLayout-DZLdEDMc.js";import{_ as de}from"./ConfirmDialog-C_e6hlR9.js";import{a as C}from"./webmail-Cgnpe0EQ.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as G,V as N,e as pe,p as ve}from"./VAvatar-BLlAVJo2.js";import{V as Y}from"./VSpacer-DL_DqXyB.js";import{V as fe,r as be}from"./VForm-B967suxO.js";import{V as xe,a as ge,b as ye}from"./VCard-CgG7Sw1Z.js";import{V as _e}from"./VTextField-4NZ7IznA.js";import{V as Me}from"./VDialog-BZ4gm6K7.js";import{V as Ve}from"./VMenu-ds-uYle9.js";import{V as he,a as R}from"./forwardRefs-DulMu961.js";import"./VContainer-CWsXUJRX.js";/* empty css              */import"./tag-BQLfwzbO.js";import"./VApp-BkjZPyh4.js";import"./layout-DYUfCptT.js";import"./ssrBoot-CTcujE2n.js";import"./global.store-DKpKwgQU.js";import"./admin-B-kSn9RO.js";import"./layout.store-BpB_lwEX.js";import"./VProgressCircular--49P1TOW.js";import"./VRow-CnohEaAX.js";import"./VSheet-CajYOL8i.js";import"./VToolbar-J3yNZ_TP.js";const Ce=["onClick","onMouseover","onMouseleave"],we={key:0,class:"font-weight-bold"},ke={key:1},Ue={key:0,class:"font-weight-bold"},$e={key:1},Be={__name:"MailboxList",props:z({mailboxes:{type:Array,default:null},lightMode:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},unseenCounters:{type:Boolean,default:!0},allowUnselect:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:z(["update:modelValue"],["update:modelValue"]),setup(S,{emit:x}){const l=S,n=oe(S,"modelValue"),i=x,h=P(),s=T(),k={inbox:"mdi-inbox",draft:"mdi-file",junk:"mdi-fire",sent:"mdi-email-fast-outline",trash:"mdi-trash-can-outline",normal:"mdi-folder-outline"},d=r(null),g=r({}),p=r({});function y(e){return e.label.split("/").pop()}function c(e){return d.value===null&&(d.value=e.unseen),d.value}function u(e,w){g.value[e.name]=w}function o(e){return n.value===e.name?"bg-primary-lighten-1":l.lightMode?g.value[e.name]?"bg-primary":"bg-white":g.value[e.name]?"bg-primary-lighten-1":"bg-primary"}function _(e){return p.value[e.name]}function I(e){p.value[e.name]||(p.value[e.name]=!1),p.value[e.name]=!p.value[e.name],p.value[e.name]&&!e.sub.length&&C.getUserMailboxes(e.name).then(w=>{e.sub=w.data.mailboxes})}function E(e){l.allowUnselect&&e===n.value?i("update:modelValue",null):i("update:modelValue",e)}return X(()=>s.mbCounterKey,()=>{C.getUserMailboxUnseen(h.query.mailbox).then(e=>{d.value=e.data.counter})}),(e,w)=>{const q=ne("MailboxList",!0);return m(),M("div",null,[(m(!0),M(O,null,ie(l.mailboxes,t=>(m(),M("div",{key:t.name,class:A(["pl-3 text-body-2",{"py-1":!l.compact}])},[L("div",{class:A([o(t),"d-flex mailbox pa-1 align-center"]),onClick:U=>E(t.name),onMouseover:U=>u(t,!0),onMouseleave:U=>u(t,!1)},[a(G,{icon:k[t.type],class:"mr-4"},null,8,["icon"]),t.name===V(h).query.mailbox?(m(),M(O,{key:0},[d.value>0?(m(),M("span",we,B(y(t))+" ("+B(c(t))+") ",1)):(m(),M("span",ke,B(y(t)),1))],64)):(m(),M(O,{key:1},[t.unseen>0?(m(),M("span",Ue,B(y(t))+" ("+B(t.unseen)+") ",1)):(m(),M("span",$e,B(y(t)),1))],64)),a(Y),t.sub?(m(),D(N,{key:2,icon:_(t)?"mdi-minus":"mdi-plus",size:"xsmall",variant:"flat",color:"transparent",onClick:H(U=>I(t),["stop"])},null,8,["icon","onClick"])):Q("",!0)],42,Ce),_(t)&&t.sub&&t.sub.length?(m(),D(q,{key:0,modelValue:n.value,"onUpdate:modelValue":w[0]||(w[0]=U=>n.value=U),mailboxes:t.sub,class:"mt-1","light-mode":l.lightMode,compact:l.compact},null,8,["modelValue","mailboxes","light-mode","compact"])):Q("",!0)],2))),128))])}}},J=ce(Be,[["__scopeId","data-v-62d5beb0"]]),Le={class:"mb-2 rounded-lg"},Ne={__name:"MailboxForm",props:{userMailboxes:Array,mailbox:{type:String,default:null},hdelimiter:{type:String,default:null}},emits:["close","mailboxRenamed"],setup(S,{emit:x}){const l=S,n=x,{$gettext:i}=W(),{displayNotification:h}=T(),s=r({}),k=r(),d=r(!1),g=F(()=>l.mailbox?i("Edit mailbox"):i("Create new mailbox")),p=F(()=>l.mailbox?i("Update"):i("Create")),y=()=>{s.value={},n("close")},c=async()=>{const{valid:u}=await k.value.validate();if(u){d.value=!0;try{const o={...s.value};l.mailbox?(o.oldname=l.mailbox,await C.renameUserMailbox(o),h({msg:i("Mailbox renamed")}),n("mailboxRenamed",`${o.parent_mailbox}${l.hdelimiter}${o.name}`)):(await C.createUserMailbox(o),h({msg:i("Mailbox created")})),y()}finally{d.value=!1}}};return X(()=>l.mailbox,u=>{if(u){const o=l.mailbox.split(l.hdelimiter);s.value.name=o.slice(-1)[0],s.value.parent_mailbox=o.slice(0,-1).join(l.hdelimiter)}else s.value={}},{immediate:!0}),(u,o)=>(m(),D(ye,{title:g.value},{default:f(()=>[a(xe,null,{default:f(()=>[a(fe,{ref_key:"formRef",ref:k},{default:f(()=>[a(_e,{modelValue:s.value.name,"onUpdate:modelValue":o[0]||(o[0]=_=>s.value.name=_),label:V(i)("Name"),variant:"outlined",density:"compact",rules:[V(be).required]},null,8,["modelValue","label","rules"]),L("div",Le,[L("h4",null,B(V(i)("Parent mailbox")),1),a(J,{modelValue:s.value.parent_mailbox,"onUpdate:modelValue":o[1]||(o[1]=_=>s.value.parent_mailbox=_),"active-mailbox":l.parent,mailboxes:l.userMailboxes,"light-mode":"",compact:"","unseen-counters":!1,"allow-unselect":""},null,8,["modelValue","active-mailbox","mailboxes"])])]),_:1},512)]),_:1}),a(ge,null,{default:f(()=>[a(Y),a(N,{text:V(i)("Close"),variant:"flat",loading:d.value,onClick:y},null,8,["text","loading"]),a(N,{text:p.value,variant:"tonal",color:"primary",loading:d.value,onClick:c},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},Se={class:"d-flex align-center"},qe={class:"d-flex justify-center mb-4"},Fe={class:"border-t-sm d-flex align-center bg-grey"},sa={__name:"WebmailLayout",async setup(S){let x,l;const{$gettext:n}=W(),i=P(),h=se(),s=T(),k=r(),d=r(!0),g=r(!1),p=r(null),y=r(null),c=r(null),u=r(i.query.mailbox||"INBOX"),o=r(!1),_=r([]),I=F(()=>["INBOX"].includes(i.query.mailbox||"INBOX")),E=F(()=>c.value.usage<50?"info":c.value.usage<80?"warning":"error"),e=F(()=>`${c.value.current} / ${c.value.limit} (${c.value.usage}%)`);function w(b){h.push({name:"MailboxView",query:{mailbox:b}}),C.getUserMailboxQuota(b).then(v=>{c.value=v.data})}const q=async()=>{const b=await C.getUserMailboxes();_.value=b.data.mailboxes,y.value=b.data.hdelimiter},t=()=>{h.push({name:"ComposeEmailView"})},U=()=>{o.value=!1,p.value=null,q()},Z=()=>{o.value=!0},ee=()=>{p.value=u.value,o.value=!0},j=b=>{u.value=b,h.push({name:"MailboxView",query:{mailbox:b}})},ae=async()=>{await C.compressUserMailbox({name:u.value}),s.displayNotification({msg:n("Mailbox compressed")})},le=async()=>{await k.value.open(n("Warning"),n("Delete this mailbox?"),{color:"warning",agreeLabel:n("Yes"),cancelLabel:n("No")})&&(await C.deleteUserMailbox({name:u.value}),s.displayNotification({msg:n("Mailbox deleted")}),j("INBOX"))};X(()=>s.dataKey,()=>{q()}),[x,l]=K(()=>q()),await x,l();const te=([x,l]=K(()=>C.getUserMailboxQuota(i.query.mailbox||"INBOX")),x=await x,l(),x);return c.value=te.data,(b,v)=>(m(),M(O,null,[a(re,null,{navbar:f(()=>[a(ue,{modelValue:d.value,"onUpdate:modelValue":v[2]||(v[2]=$=>d.value=$),rail:g.value,permanent:"",color:"primary",app:""},{prepend:f(()=>[L("div",Se,[a(ve,{src:me,"max-width":"190",class:"logo"}),a(N,{icon:g.value?"mdi-chevron-right":"mdi-chevron-left",variant:"text",onClick:v[0]||(v[0]=H($=>g.value=!g.value,["stop"]))},null,8,["icon"])]),L("div",qe,[a(N,{text:V(n)("Compose"),color:"secondary",variant:"flat","prepend-icon":"mdi-pencil",onClick:t},null,8,["text"])])]),append:f(()=>[L("div",Fe,[a(N,{class:"ml-2",variant:"text",icon:"",size:"small"},{default:f(()=>[a(G,{icon:"mdi-cog"}),a(Ve,{activator:"parent"},{default:f(()=>[a(he,{density:"compact"},{default:f(()=>[a(R,{title:V(n)("Create a new mailbox"),"prepend-icon":"mdi-plus",onClick:Z},null,8,["title"]),a(R,{title:V(n)("Edit this mailbox"),"prepend-icon":"mdi-pencil",disabled:I.value,onClick:ee},null,8,["title","disabled"]),a(R,{title:V(n)("Delete this mailbox"),"prepend-icon":"mdi-trash-can",disabled:I.value,onClick:le},null,8,["title","disabled"]),a(R,{title:V(n)("Compress this mailbox"),"prepend-icon":"mdi-folder-zip-outline",onClick:ae},null,8,["title"])]),_:1})]),_:1})]),_:1}),c.value?(m(),D(pe,{key:0,color:E.value,"model-value":c.value.usage,title:e.value},null,8,["color","model-value","title"])):Q("",!0)])]),default:f(()=>[a(J,{modelValue:u.value,"onUpdate:modelValue":[v[1]||(v[1]=$=>u.value=$),w],mailboxes:_.value,class:"mr-2"},null,8,["modelValue","mailboxes"])]),_:1},8,["modelValue","rail"])]),_:1}),a(Me,{modelValue:o.value,"onUpdate:modelValue":v[4]||(v[4]=$=>o.value=$),"max-width":"800"},{default:f(()=>[a(Ne,{"user-mailboxes":_.value,mailbox:p.value,hdelimiter:y.value,onMailboxRenamed:j,onClose:v[3]||(v[3]=$=>U())},null,8,["user-mailboxes","mailbox","hdelimiter"])]),_:1},8,["modelValue"]),a(de,{ref_key:"confirm",ref:k},null,512)],64))}};export{sa as default};
