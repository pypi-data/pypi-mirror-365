import{d as P}from"./index-DSETu0oI.js";import{_ as V,b as U,m as G,g as h,c as k,w as a,a as s,e as q,f as d,A as D,k as n,t as m,l as x,F as w,i as y,o as u}from"./index-BA5nENc7.js";import{_ as S}from"./MenuItems-Cuf8-V0W.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as N}from"./VMenu-ds-uYle9.js";import{V as M,d as H}from"./VAvatar-BLlAVJo2.js";import{V as L}from"./VChip-DtLoN5pb.js";import{V as E,a as J}from"./VToolbar-J3yNZ_TP.js";import{V as K}from"./VTextField-4NZ7IznA.js";import{V as Q}from"./forwardRefs-DulMu961.js";import{V as W}from"./VDataTableServer-D_lPUXtC.js";import{b as X}from"./VCard-CgG7Sw1Z.js";import"./VProgressCircular--49P1TOW.js";import"./tag-BQLfwzbO.js";import"./ssrBoot-CTcujE2n.js";import"./VDataTable-C75c5ugx.js";import"./VSelect-BiP6crf0.js";import"./VCheckboxBtn-Bxy-LfII.js";import"./VSelectionControl-CCdZN5dG.js";import"./VTable-Dtu3KidF.js";import"./filter-C-VZW-D6.js";const b="alarms",v={getAll(i){return V.get(`${b}/`,{params:i})},switchStatus(i,e){return V.patch(`${b}/${i}/switch/`,e)},delete(i){return V.delete(`${b}/${i}/`)},bulkDelete(i){return V.delete(`${b}/bulk_delete/`,{params:{ids:i}})}},Y={class:"text-right"},Z={__name:"AlarmList",setup(i){const{$gettext:e}=U(),p=G(),$=h([]),A=h(!1),f=h(""),_=h([]),C=h(0),z=[{title:e("Triggered"),key:"created"},{title:e("Status"),key:"status"},{title:e("Domain"),key:"domain.name",sortable:!1},{title:e("Mailbox"),key:"mailbox",sortable:!1},{title:e("Message"),key:"title"},{title:e("Actions"),key:"actions",sortable:!1,align:"right"}];function I(){const l=[];return _.value.length>0&&l.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:B,color:"red"}),l.push({label:e("Reload"),icon:"mdi-reload",onClick:r}),l}function O(l){const o=[];return o.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:R,color:"red"}),l.status===y.ALARM_OPENED?o.push({label:e("Close alarm"),icon:"mdi-check",onClick:j,color:"green"}):o.push({label:e("Reopen alarm"),icon:"mdi-alert-circle-outline",onClick:F,color:"orange"}),o}function r({page:l,itemsPerPage:o,sortBy:t}){const g={page:l||1,page_size:o||10};t&&t.length&&(g.ordering=t.map(c=>c.order!=="asc"?`-${c.key}`:c.key).join(",")),f.value!==""&&(g.search=f.value),A.value=!0,v.getAll(g).then(c=>{$.value=c.data.results,C.value=c.data.count,A.value=!1})}async function R(l,o=!0){v.delete(l.id).then(()=>{o&&(p.displayNotification({msg:e("Alarm deleted")}),r({}))})}async function B(){await v.bulkDelete(_.value.map(l=>l.id)),p.displayNotification({msg:e("Alarms deleted")}),_.value=[],r({})}async function j(l){v.switchStatus(l.id,{status:y.ALARM_CLOSED}).then(()=>{p.displayNotification({msg:e("Alarm closed")}),r({})})}async function F(l){v.switchStatus(l.id,{status:y.ALARM_OPENED}).then(()=>{p.displayNotification({msg:e("Alarm re-opened")}),r({})})}return r=P(r,500),(l,o)=>(u(),k(X,{class:"mt-6"},{default:a(()=>[s(W,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=t=>_.value=t),headers:z,items:$.value,search:f.value,"item-value":"id","items-length":C.value,loading:A.value,elevation:"0","show-select":"","onUpdate:options":r},{top:a(()=>[s(E,{color:"white",flat:""},{default:a(()=>[s(K,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t),"prepend-inner-icon":"mdi-magnify",placeholder:d(e)("Search"),density:"compact",variant:"outlined","hide-details":"",flat:"","single-line":"",class:"flex-grow-0 w-33 mr-4"},null,8,["modelValue","placeholder"]),s(N,{location:"bottom"},{activator:a(({props:t})=>[s(M,D(t,{size:"small"}),{default:a(()=>[n(m(d(e)("Actions"))+" ",1),s(H,{right:""},{default:a(()=>o[2]||(o[2]=[n("mdi-chevron-down")])),_:1,__:[2]})]),_:2},1040)]),default:a(()=>[s(Q,{density:"compact"},{default:a(()=>[s(d(S),{items:I()},null,8,["items"])]),_:1})]),_:1})]),_:1})]),"item.status":a(({item:t})=>[t.status===1?(u(),k(L,{key:0,color:"warning",size:"small"},{default:a(()=>[n(m(d(e)("Opened")),1)]),_:1})):(u(),k(L,{key:1,color:"info",size:"small"},{default:a(()=>[n(m(d(e)("Closed")),1)]),_:1}))]),"item.mailbox":a(({item:t})=>[t.mailbox?(u(),x(w,{key:0},[n(m(t.mailbox.address)+"@"+m(t.domain.name),1)],64)):(u(),x(w,{key:1},[n(" / ")],64))]),"item.created":a(({item:t})=>[n(m(l.$date(t.created)),1)]),"item.actions":a(({item:t})=>[q("div",Y,[s(N,{location:"bottom"},{activator:a(({props:g})=>[s(M,D({icon:"mdi-dots-horizontal"},g,{variant:"text"}),null,16)]),default:a(()=>[s(d(S),{items:O(t),obj:t},null,8,["items","obj"])]),_:2},1024)])]),_:2},1032,["modelValue","items","search","items-length","loading"])]),_:1}))}},ee=T(Z,[["__scopeId","data-v-43da963f"]]),te={__name:"AlarmsView",setup(i){return(e,p)=>(u(),x(w,null,[s(E,{flat:""},{default:a(()=>[s(J,null,{default:a(()=>[n(m(e.$gettext("Opened alarms")),1)]),_:1})]),_:1}),s(ee)],64))}},ye=T(te,[["__scopeId","data-v-d7e4ea18"]]);export{ye as default};
