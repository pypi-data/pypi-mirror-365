import{r as c,j as e}from"./@radix-C_LirfyT.js";import{c as N,u as R}from"./bulk-delete-B5RTlnD_.js";import{p as D}from"./index-BQWlHo1Y.js";import{y as k,F as A,E as _,G as E,H as O,B as C,J as I,K as F,L as B,M as L,N as f,r as p,O as z,Q as $,R as M,U as H,V as g,T as U,z as d,W as G,d as j}from"./index-BacoJBEQ.js";import{c as Q,b as q}from"./@tanstack-C0SeHZng.js";import{S as K}from"./refresh-3EF2R7ja.js";import{P as J}from"./Pagination-CcDD5yHh.js";import{S as V}from"./SearchField-D_0-uAPj.js";import{S as P}from"./trash-HKxXWbSG.js";import{D as S,a as v}from"./DeleteAlertDialog-BbyFVnVI.js";import{S as W}from"./pipeline-BJ8liDnl.js";import{S as X}from"./terminal-BObrvDlO.js";import{g as Y,E as Z,a as ee}from"./ExecutionStatus-C4tlFnlh.js";import{L as m,f as te}from"./@react-router-BSsrkPOd.js";import{A as se}from"./AlertDialogDropdownItem-druRNuO2.js";import"./@reactflow-D9hglKLF.js";import"./chevron-right-double-CbRQKN4Q.js";import"./index-BRhKF2z-.js";import"./zod-DgEcN9jD.js";import"./index.esm-COnaHLSh.js";import"./check-circle-mnEgPhPF.js";import"./help-B0CvBhCm.js";async function ne({pipelineId:t}){const s=k(_.pipelines.detail(t)),n=await fetch(s,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const a=await n.json().then(r=>r.detail).catch(()=>`Failed to delete pipeline ${t}`);throw new A({status:n.status,statusText:n.statusText,message:a})}return n.json()}function ae(t){return Q({mutationFn:ne,...t})}const{ContextProvider:re,useContext:u}=N();function w(){const{setRowSelection:t}=u(),{mutateAsync:s}=ae();async function n(a){await s({pipelineId:a})}return R({deleteFn:n,queryKeyToInvalidate:D.all,setRowSelection:t})}function ie(){const[t,s]=c.useState(!1),{selectedRowCount:n,selectedRowIDs:a}=u(),{bulkDelete:r}=w();async function i(){await r(a),s(!1)}return e.jsxs(E,{open:t,onOpenChange:s,children:[e.jsx(O,{asChild:!0,children:e.jsxs(C,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(P,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(S,{title:`Delete Pipeline${n>=2?"s":""}`,handleDelete:i,children:e.jsxs(v,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})]})}function oe(){const{selectedRowCount:t}=u();return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${t} Pipeline${t>1?"s":""} selected`}),e.jsx(ie,{})]})}function le({id:t}){const[s,n]=c.useState(!1),[a,r]=c.useState(!1),i=c.useRef(null),o=c.useRef(null),{bulkDelete:y}=w();async function b(){await y([t]),x(!1)}function T(){o.current=i.current}function x(l){if(l===!1){r(!1),setTimeout(()=>{n(l)},200);return}n(l)}return e.jsxs(I,{onOpenChange:r,open:a,children:[e.jsx(F,{ref:i,children:e.jsx(B,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsx(L,{hidden:s,onCloseAutoFocus:l=>{o.current&&(o.current.focus(),o.current=null,l.preventDefault())},align:"end",sideOffset:7,children:e.jsx(se,{onSelect:T,open:s,onOpenChange:x,triggerChildren:"Delete",icon:e.jsx(P,{fill:"red"}),children:e.jsx(S,{title:"Delete Pipeline",handleDelete:b,children:e.jsxs(v,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})})]})}function ce(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(f,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(f,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Pipeline",cell:({row:t})=>{var s,n,a;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(W,{className:`h-5 w-5 ${Y((s=t.original.resources)==null?void 0:s.latest_run_status)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{to:p.projects.pipelines.namespace(encodeURIComponent(t.original.name)),className:"flex items-center gap-1",children:e.jsx("span",{className:"text-text-md font-semibold text-theme-text-primary",children:t.original.name})}),e.jsx(z,{children:e.jsxs($,{children:[e.jsx(M,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(Z,{status:(n=t.original.resources)==null?void 0:n.latest_run_status})}),e.jsx(H,{className:"z-20 capitalize",children:(a=t.original.resources)==null?void 0:a.latest_run_status})]})}),e.jsx(g,{copyText:t.original.name})]}),e.jsxs(m,{to:p.projects.pipelines.namespace(encodeURIComponent(t.original.name)),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:t.original.id.split("-")[0]}),e.jsx(g,{copyText:t.original.id})]})]})]})}},{id:"latest-run",header:"Latest Run",accessorFn:t=>{var s,n;return{status:(s=t.resources)==null?void 0:s.latest_run_status,runId:(n=t.resources)==null?void 0:n.latest_run_id}},cell:({getValue:t})=>{const{runId:s,status:n}=t();return!s||!n?e.jsx("div",{children:"No run"}):e.jsx(m,{to:p.projects.runs.detail(s),children:e.jsxs(U,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:ee(n),children:[e.jsx(X,{className:"h-3 w-3 fill-current"}),s==null?void 0:s.split("-")[0]]})})}},{id:"admin_actions",header:"",meta:{width:"5%"},cell:({row:t})=>e.jsx(le,{id:t.original.id})}]}const h=1,de=d.object({page:d.coerce.number().min(h).optional().default(h).catch(h),name:d.string().optional(),operator:d.enum(["and","or"]).optional()});function ue(){const[t]=te(),{page:s,name:n,operator:a}=de.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:n,logical_operator:a}}function pe(){const t=ue(),{selectedRowCount:s,rowSelection:n,setRowSelection:a}=u(),{data:r,refetch:i}=q({...D.pipelineList({...t,sort_by:"desc:latest_run"}),throwOnError:!0});return e.jsxs("div",{className:"flex flex-col gap-5 pt-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[s?e.jsx(oe,{}):e.jsx(V,{searchParams:t}),e.jsx("div",{className:"flex justify-between",children:e.jsxs(C,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>i(),children:[e.jsx(K,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:r?e.jsx(G,{rowSelection:n,onRowSelectionChange:a,getRowId:o=>o.id,columns:ce(),data:r.items}):e.jsx(j,{className:"h-[500px] w-full"})}),r?r.total_pages>1&&e.jsx(J,{searchParams:t,paginate:r}):e.jsx(j,{className:"h-[36px] w-[300px]"})]})]})}function Ie(){return e.jsx(re,{children:e.jsx(pe,{})})}export{Ie as default};
