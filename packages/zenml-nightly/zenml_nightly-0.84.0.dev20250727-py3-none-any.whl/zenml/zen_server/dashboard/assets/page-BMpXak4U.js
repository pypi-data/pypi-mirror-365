import{r as l,j as e}from"./@radix-C_LirfyT.js";import{v as C,y as b,F as y,E as D,aA as M,aB as F,B as h,aC as T,aD as E,D as P,aE as U,s as v,I as O,aF as k,aG as I,aH as H,aI as _,t as N,z as u,aJ as R,aK as z,aL as B,aM as q,aN as K,J as V,K as L,L as Z,M as G,a0 as J,am as j,aO as Q,u as W,d as f,W as $,j as X}from"./index-BacoJBEQ.js";import{S as Y}from"./SearchField-D_0-uAPj.js";import{C as ee}from"./CodeSnippet-D8iBqOVv.js";import{c as w,h as A}from"./@tanstack-C0SeHZng.js";import{u as se}from"./index.esm-COnaHLSh.js";import{D as ae}from"./DisplayDate-v3KW7oez.js";import{S as te}from"./slash-circle-D2Lb2FyR.js";import{A as re}from"./AlertDialogDropdownItem-druRNuO2.js";import{f as ne}from"./@react-router-BSsrkPOd.js";import{P as ie}from"./Pagination-CcDD5yHh.js";import"./@reactflow-D9hglKLF.js";import"./index-BRhKF2z-.js";import"./chevron-right-double-CbRQKN4Q.js";const oe=t=>l.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 4C8.06703 4 6.50002 5.567 6.50002 7.5C6.50002 9.433 8.06703 11 10 11C11.933 11 13.5 9.433 13.5 7.5C13.5 5.567 11.933 4 10 4ZM4.50002 7.5C4.50002 4.46243 6.96246 2 10 2C13.0376 2 15.5 4.46243 15.5 7.5C15.5 10.5376 13.0376 13 10 13C6.96246 13 4.50002 10.5376 4.50002 7.5ZM19 14C19.5523 14 20 14.4477 20 15V17H22C22.5523 17 23 17.4477 23 18C23 18.5523 22.5523 19 22 19H20V21C20 21.5523 19.5523 22 19 22C18.4477 22 18 21.5523 18 21V19H16C15.4477 19 15 18.5523 15 18C15 17.4477 15.4477 17 16 17H18V15C18 14.4477 18.4477 14 19 14ZM7.32629 14.5C7.38335 14.5 7.44125 14.5 7.50003 14.5H12C12.5523 14.5 13 14.9477 13 15.5C13 16.0523 12.5523 16.5 12 16.5H7.50003C6.03171 16.5 5.51923 16.5109 5.12917 16.6292C4.17036 16.92 3.42005 17.6703 3.1292 18.6291C3.01088 19.0192 3.00002 19.5317 3.00002 21C3.00002 21.5523 2.55231 22 2.00002 22C1.44774 22 1.00002 21.5523 1.00002 21C1.00002 20.9412 1 20.8833 0.99998 20.8263C0.999526 19.599 0.999216 18.761 1.21532 18.0486C1.70007 16.4506 2.95059 15.2 4.54859 14.7153C5.261 14.4992 6.09902 14.4995 7.32629 14.5Z"}));async function le(t){const s=b(D.users.all),a=await C(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const r=await a.json().then(n=>n.detail).catch(()=>"Failed to create User");throw new y({status:a.status,statusText:a.statusText,message:r})}return a.json()}function ce(t){return w({mutationFn:async s=>le(s),...t})}function de(){const[t,s]=l.useState(!1),[a,r]=l.useState(null);return e.jsxs(M,{open:t,onOpenChange:n=>{s(n),r(null)},children:[e.jsx(F,{asChild:!0,children:e.jsx(h,{className:"shrink-0",intent:"primary",children:"Add Member"})}),e.jsxs(T,{className:"",children:[e.jsx(E,{children:e.jsx(P,{children:" Add a New Member"})}),a?e.jsx(ue,{name:a.name,token:U(a)}):e.jsx(me,{setSuccessMember:r})]})]})}u.object({username:u.string(),isAdmin:u.boolean()});function me({setSuccessMember:t}){const{toast:s}=v(),a=A(),{mutate:r,isPending:n}=ce({onError(d){_(d)&&s({status:"error",emphasis:"subtle",icon:e.jsx(N,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:d.message,rounded:!0})},onSuccess(d){t(d),a.invalidateQueries({queryKey:["users"]})}}),c=l.useId(),o=l.useId(),{register:i,handleSubmit:x,watch:p,setValue:m}=se();function S(d){r({is_admin:d.isAdmin,name:d.username})}return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-user-form",onSubmit:x(S),className:"space-y-5 p-7",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{htmlFor:c,className:"text-text-sm",children:"Username"}),e.jsx(O,{...i("username"),id:c,className:"w-full"})]}),e.jsxs("div",{className:"flex gap-5",children:[e.jsx("label",{htmlFor:o,className:"text-text-md",children:"Add user as an Admin"}),e.jsx(k,{onCheckedChange:d=>m("isAdmin",!!d),...i("isAdmin",{value:!1}),id:o})]})]})}),e.jsxs(I,{className:"gap-[10px]",children:[e.jsx(H,{asChild:!0,children:e.jsx(h,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(h,{disabled:!p("username")||n,form:"create-user-form",size:"sm",children:"Generate Token"})]})]})}function ue({token:t,name:s}){return e.jsxs("div",{className:"space-y-5 overflow-hidden p-7 text-center",children:[e.jsx(oe,{className:"m-auto mb-5 h-[110px] w-[110px] fill-success-500"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-lg font-semibold text-theme-text-primary",children:`The user ${s} was created successfully!`}),e.jsx("p",{className:"text-text-md text-theme-text-secondary",children:"Share the invitation link with the user to complete the registration."})]}),e.jsx(ee,{className:"mx-auto",code:t})]})}async function he(t){const s=b(D.users.detail(t)),a=await C(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok){const r=await a.json().then(n=>n.detail).catch(()=>"Failed to delete User");throw new y({status:a.status,statusText:a.statusText,message:r})}return a.json()}function xe(t){return w({mutationFn:async s=>he(s),...t})}function pe({userId:t,name:s}){const{toast:a}=v(),r=A(),{isPending:n,mutate:c}=xe({onSuccess(){r.invalidateQueries({queryKey:["users"]})},onError:i=>{i instanceof Error&&a({status:"error",emphasis:"subtle",icon:e.jsx(N,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:i.message,rounded:!0})}});function o(){c(t)}return e.jsxs(R,{className:"p-0",children:[e.jsx(z,{className:"py-2 pl-5 pr-3 text-text-lg font-semibold",children:"Delete Member"}),e.jsx("div",{className:"border-y border-theme-border-moderate px-5 py-5",children:e.jsxs(B,{children:["Deleting ",e.jsx("strong",{children:s})," cannot be undone."]})}),e.jsxs("div",{className:"flex justify-end gap-3 px-5 py-3",children:[e.jsx(q,{asChild:!0,children:e.jsx(h,{intent:"secondary",children:"Cancel"})}),e.jsx(K,{asChild:!0,children:e.jsx(h,{onClick:o,disabled:n,intent:"danger",children:"Delete"})})]})]})}function fe({userId:t,name:s}){const[a,r]=l.useState(!1),[n,c]=l.useState(!1),o=l.useRef(null),i=l.useRef(null);function x(){i.current=o.current}function p(m){if(m===!1){c(!1),setTimeout(()=>{r(m)},200);return}r(m)}return e.jsxs(V,{onOpenChange:c,open:n,children:[e.jsx(L,{ref:o,children:e.jsx(Z,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsx(G,{hidden:a,onCloseAutoFocus:m=>{i.current&&(i.current.focus(),i.current=null,m.preventDefault())},align:"end",sideOffset:7,children:e.jsx(re,{onSelect:x,onOpenChange:p,triggerChildren:"Remove Member",icon:e.jsx(te,{fill:"red"}),children:e.jsx(pe,{name:s,userId:t})})})]})}function ge({isAdmin:t}){return[{id:"name",accessorFn:s=>{var a;return{name:s.name,is_admin:!!((a=s.body)!=null&&a.is_admin)}},cell:({getValue:s})=>{const{name:a,is_admin:r}=s();return e.jsxs("div",{className:"flex",children:[e.jsx(J,{username:a}),r&&e.jsx("div",{children:e.jsx(j,{className:"ml-2 capitalize",size:"xs",color:"purple",children:"Admin"})})]})},header:"User"},{accessorKey:"status",header:"Status",accessorFn:s=>{var a;return{status:(a=s.body)==null?void 0:a.active}},cell:({getValue:s})=>{const{status:a}=s();return e.jsx(j,{className:"capitalize",color:a?"green":"grey",children:a?"Active":"Inactive"})}},{id:"created",header:"Created",accessorFn:s=>{var a;return(a=s.body)==null?void 0:a.created},cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(ae,{dateString:s()})})},...t?[{id:"actions",header:"",accessorFn:s=>({id:s.id,name:s.name}),meta:{width:"5%"},cell:({getValue:s})=>{const{id:a,name:r}=s();return e.jsx(fe,{name:r,userId:a})}}]:[]]}const g=1,je=u.object({page:u.coerce.number().min(g).optional().default(g).catch(g),name:u.string().optional(),operator:u.enum(["and","or"]).optional()});function Ce(){const[t]=ne(),{page:s,name:a,operator:r}=je.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:a,logical_operator:r}}function be(){var o,i;const t=Ce(),{data:s,isError:a}=Q({params:{...t,sort_by:"desc:created"}},{throwOnError:!0}),{data:r,isPending:n,isError:c}=W();return a||c?null:n?e.jsx(f,{className:"h-[350px]"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(Y,{searchParams:t}),((o=r.body)==null?void 0:o.is_admin)&&e.jsx(de,{})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:s?e.jsx($,{columns:ge({isAdmin:(i=r.body)==null?void 0:i.is_admin}),data:s.items}):e.jsx(f,{className:"h-[250px] w-full"})}),s?s.total_pages>1&&e.jsx(ie,{searchParams:t,paginate:s}):e.jsx(f,{className:"h-[36px] w-[300px]"})]})]})}function ke(){return e.jsxs(X,{className:"flex flex-col gap-4 p-5",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Members"}),e.jsx(be,{})]})}export{ke as default};
