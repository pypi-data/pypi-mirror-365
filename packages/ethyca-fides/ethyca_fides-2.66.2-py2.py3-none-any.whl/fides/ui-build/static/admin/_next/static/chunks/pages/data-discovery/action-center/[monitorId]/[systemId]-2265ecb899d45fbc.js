(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4154],{58095:function(e,t,s){var n=s(8817);e.exports=function(e,t){return!!(null==e?0:e.length)&&n(e,t,0)>-1}},21796:function(e){e.exports=function(e,t,s){for(var n=-1,r=null==e?0:e.length;++n<r;)if(s(t,e[n]))return!0;return!1}},8817:function(e,t,s){var n=s(95372),r=s(1129),a=s(58263);e.exports=function(e,t,s){return t==t?a(e,t,s):n(e,r,s)}},1129:function(e){e.exports=function(e){return e!=e}},92198:function(e,t,s){var n=s(52485),r=s(58095),a=s(21796),o=s(65581),i=s(47111),l=s(43735);e.exports=function(e,t,s){var d=-1,c=r,u=e.length,g=!0,m=[],h=m;if(s)g=!1,c=a;else if(u>=200){var v=t?null:i(e);if(v)return l(v);g=!1,c=o,h=new n}else h=t?[]:m;e:for(;++d<u;){var y=e[d],p=t?t(y):y;if(y=s||0!==y?y:0,g&&p==p){for(var f=h.length;f--;)if(h[f]===p)continue e;t&&h.push(p),m.push(y)}else c(h,p,s)||(h!==m&&h.push(p),m.push(y))}return m}},47111:function(e,t,s){var n=s(46151),r=s(50344),a=s(43735),o=n&&1/a(new n([,-0]))[1]==1/0?function(e){return new n(e)}:r;e.exports=o},58263:function(e){e.exports=function(e,t,s){for(var n=s-1,r=e.length;++n<r;)if(e[n]===t)return n;return -1}},50344:function(e){e.exports=function(){}},83766:function(e,t,s){var n=s(92198);e.exports=function(e){return e&&e.length?n(e):[]}},25654:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/data-discovery/action-center/[monitorId]/[systemId]",function(){return s(56514)}])},35287:function(e,t,s){"use strict";var n=s(24246),r=s(13577),a=s(88038),o=s.n(a);s(27378),t.Z=e=>{let{children:t,title:s,mainProps:a}=e;return(0,n.jsxs)(r.kCb,{"data-testid":s,direction:"column",height:"calc(100vh - 48px)",width:"calc(100vw - 240px)",children:[(0,n.jsxs)(o(),{children:[(0,n.jsxs)("title",{children:["Fides Admin UI - ",s]}),(0,n.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)(r.kCb,{px:10,py:6,as:"main",overflow:"auto",direction:"column",flex:1,minWidth:0,...a,children:t})]})}},14047:function(e,t,s){"use strict";s.d(t,{H:function(){return a},V:function(){return n.V}});var n=s(84306),r=s(812);let a=()=>{let{errorAlert:e}=(0,n.V)();return{handleError:t=>{let s="An unexpected error occurred. Please try again.";(0,r.Ot)(t)?s=t.data.detail:(0,r.tB)(t)&&(s=t.data.detail[0].msg),e(s)}}}},84306:function(e,t,s){"use strict";s.d(t,{V:function(){return a}});var n=s(24246),r=s(13577);let a=()=>{let e=(0,r.pmc)();return{errorAlert:(t,s,a)=>{let o={...a,position:(null==a?void 0:a.position)||"top",render:e=>{let{onClose:a}=e;return(0,n.jsxs)(r.bZj,{alignItems:"normal",status:"error","data-testid":"error-alert",children:[(0,n.jsx)(r.zMQ,{}),(0,n.jsxs)(r.xuv,{children:[s&&(0,n.jsx)(r.CdC,{children:s}),(0,n.jsx)(r.XaZ,{children:t})]}),(0,n.jsx)(r.PZ7,{onClick:a,position:"relative",right:0,size:"sm",top:-1})]})}};(null==a?void 0:a.id)&&e.isActive(a.id)?e.update(a.id,o):e(o)},successAlert:(t,s,a)=>{let o={...a,position:(null==a?void 0:a.position)||"top",render:e=>{let{onClose:a}=e;return(0,n.jsxs)(r.bZj,{alignItems:"normal",status:"success",variant:"subtle","data-testid":"success-alert",children:[(0,n.jsx)(r.zMQ,{}),(0,n.jsxs)(r.xuv,{children:[s&&(0,n.jsx)(r.CdC,{children:s}),(0,n.jsx)(r.XaZ,{children:t})]}),(0,n.jsx)(r.PZ7,{onClick:a,position:"relative",right:0,size:"sm",top:-1})]})}};(null==a?void 0:a.id)&&e.isActive(a.id)?e.update(a.id,o):e(o)}}}},45938:function(e,t,s){"use strict";s.d(t,{Gt:function(){return g},eB:function(){return m},oI:function(){return u}});var n=s(24246),r=s(34090),a=s(27378),o=s(16134),i=s(38602),l=s(58452);let d=(0,a.createRef)(),c=(0,a.createRef)(),u=()=>{let e=(0,o.T)(),t=(0,o.C)(i.DB),s=(0,a.useCallback)(()=>{c.current=void 0,d.current=void 0},[]),n=(0,a.useCallback)(()=>{e((0,i.Mr)()),c.current&&(c.current(!0),s())},[e,s]),r=(0,a.useCallback)(()=>{e((0,i.Mr)()),c.current&&(c.current(!1),s())},[e,s]);return{attemptAction:(0,a.useCallback)(()=>t?(e((0,i.h7)()),d.current||(d.current=new Promise(e=>{c.current=e})),d.current):Promise.resolve(!0),[t,e]),onConfirm:n,onClose:r}},g=e=>{let{id:t,name:s}=e,{dirty:n}=(0,r.u6)(),l=(0,o.T)();return(0,a.useEffect)(()=>(l((0,i.Zu)({id:t,name:s})),()=>{l((0,i.dz)({id:t}))}),[l,t,s]),(0,a.useEffect)(()=>{l((0,i.$p)({id:t,isDirty:n}))},[n,l,t]),null},m=()=>{let{onConfirm:e,onClose:t}=u(),s=(0,o.C)(i.uv);return(0,n.jsx)(l.Z,{isOpen:s,onClose:t,onConfirm:e,isCentered:!0,title:"Unsaved Changes",message:"You have unsaved changes"})}},54762:function(e,t,s){"use strict";s.d(t,{l:function(){return i}});var n=s(24246),r=s(13577),a=s(62165),o=s(73825);let i=e=>{let{consentStatus:t}=e,{flags:s}=(0,a.hz)(),{assetConsentStatusLabels:i}=s;return i&&(null==t?void 0:t.status)===o.pF.ALERT?(0,n.jsx)(r.esZ,{title:null==t?void 0:t.message,"data-testid":"discovery-status-icon-alert-tooltip",children:(0,n.jsx)("div",{className:"mb-px","data-testid":"discovery-status-icon-alert",children:(0,n.jsx)(r.PJP.OdJ,{style:{color:"var(--fidesui-error)"}})})}):null}},9320:function(e,t,s){"use strict";s.d(t,{_:function(){return a}});var n=s(24246),r=s(26089);let a=(e,t)=>(0,n.jsxs)(n.Fragment,{children:[e," ",t&&(0,n.jsx)(r.Z,{onClick:t,children:"View"})]})},37059:function(e,t,s){"use strict";s.d(t,{Ak:function(){return v},EY:function(){return u},Tj:function(){return m},Ud:function(){return o},Vr:function(){return y},WJ:function(){return l},mi:function(){return p},nP:function(){return c},nS:function(){return g},rs:function(){return d},sX:function(){return h},wi:function(){return i}});var n=s(78780),r=s(16394),a=s(73825);let{useGetAggregateMonitorResultsQuery:o,useGetDiscoveredSystemAggregateQuery:i,useGetDiscoveredAssetsQuery:l,useAddMonitorResultSystemsMutation:d,useIgnoreMonitorResultSystemsMutation:c,useAddMonitorResultAssetsMutation:u,useIgnoreMonitorResultAssetsMutation:g,useRestoreMonitorResultAssetsMutation:m,useUpdateAssetsSystemMutation:h,useUpdateAssetsDataUseMutation:v,useUpdateAssetsMutation:y,useGetConsentBreakdownQuery:p}=n.u.injectEndpoints({endpoints:e=>({getAggregateMonitorResults:e.query({query:e=>{let{page:t=1,size:s=20,search:n}=e;return{url:"/plus/discovery-monitor/aggregate-results",params:{page:t,size:s,search:n,diff_status:"addition"}}},providesTags:["Discovery Monitor Results"]}),getDiscoveredSystemAggregate:e.query({query:e=>{let{key:t,page:s=1,size:n=20,search:r,diff_status:a}=e;return{url:"/plus/discovery-monitor/system-aggregate-results",params:{monitor_config_id:t,page:s,size:n,search:r,diff_status:a}}},providesTags:["Discovery Monitor Results"]}),getDiscoveredAssets:e.query({query:e=>{let{key:t,system:s,page:n=1,size:a=20,search:o,diff_status:i,sort_by:l=["consent_aggregated","urn"],sort_asc:d=!0}=e;return{url:"/plus/discovery-monitor/".concat(t,"/results?").concat((0,r.du)(Array.isArray(l)?l:[l],"sort_by")),params:{resolved_system_id:s,page:n,size:a,search:o,diff_status:i,sort_asc:d}}},providesTags:()=>["Discovery Monitor Results"]}),addMonitorResultSystems:e.mutation({query:e=>{let{monitor_config_key:t,resolved_system_ids:s}=e,n=(0,r.du)(s,"resolved_system_ids");return{method:"POST",url:"/plus/discovery-monitor/".concat(t,"/promote?").concat(n)}},invalidatesTags:["Discovery Monitor Results"]}),ignoreMonitorResultSystems:e.mutation({query:e=>{let{monitor_config_key:t,resolved_system_ids:s}=e,n=(0,r.du)(s,"resolved_system_ids");return{method:"POST",url:"/plus/discovery-monitor/".concat(t,"/mute?").concat(n)}},invalidatesTags:["Discovery Monitor Results"]}),addMonitorResultAssets:e.mutation({query:e=>{var t;let s=new URLSearchParams;return null===(t=e.urnList)||void 0===t||t.forEach(e=>s.append("staged_resource_urns",e)),{method:"POST",url:"/plus/discovery-monitor/promote?".concat(s)}},invalidatesTags:["Discovery Monitor Results"]}),ignoreMonitorResultAssets:e.mutation({query:e=>{var t;let s=new URLSearchParams;return null===(t=e.urnList)||void 0===t||t.forEach(e=>s.append("staged_resource_urns",e)),{method:"POST",url:"/plus/discovery-monitor/mute?".concat(s)}},invalidatesTags:["Discovery Monitor Results"]}),restoreMonitorResultAssets:e.mutation({query:e=>{var t;let s=new URLSearchParams({status_to_set:a.LL.ADDITION});return null===(t=e.urnList)||void 0===t||t.forEach(e=>s.append("staged_resource_urns",e)),{method:"POST",url:"/plus/discovery-monitor/un-mute?".concat(s)}},invalidatesTags:["Discovery Monitor Results"]}),updateAssetsSystem:e.mutation({query:e=>({method:"PATCH",url:"/plus/discovery-monitor/".concat(e.monitorId,"/results"),body:e.urnList.map(t=>({urn:t,user_assigned_system_key:e.systemKey}))}),invalidatesTags:["Discovery Monitor Results","System Assets"]}),updateAssetsDataUse:e.mutation({query:e=>({method:"PATCH",url:"/plus/discovery-monitor/".concat(e.monitorId,"/results"),body:e.urnList.map(t=>({urn:t,user_assigned_data_uses:e.dataUses}))}),invalidatesTags:["Discovery Monitor Results"]}),updateAssets:e.mutation({query:e=>({method:"PATCH",url:"/plus/discovery-monitor/".concat(e.monitorId,"/results"),body:e.assets}),invalidatesTags:["Discovery Monitor Results"]}),getConsentBreakdown:e.query({query:e=>{let{stagedResourceUrn:t,status:s,page:n=1,size:r=20}=e;return{url:"/plus/discovery-monitor/staged_resource/".concat(encodeURIComponent(t),"/consent"),params:{status:s,page:n,size:r}}}})})})},88708:function(e,t,s){"use strict";s.d(t,{A:function(){return r}});var n,r,a=s(27378),o=s(14908),i=s(73825);(n=r||(r={})).ATTENTION_REQUIRED="attention-required",n.RECENT_ACTIVITY="recent-activity",n.IGNORED="ignored",t.Z=e=>{let{activeTab:t,onTabChange:s}=(0,o.Z)({tabKeys:Object.values(r)}),n=(0,a.useMemo)(()=>[{label:"Attention required",params:{diff_status:[i.LL.ADDITION],system:e},hash:"attention-required"},{label:"Recent activity",params:{diff_status:[i.LL.MONITORED]},hash:"recent-activity"},{label:"Ignored",params:{diff_status:[i.LL.MUTED],system:e},hash:"ignored"}],[e]),{diff_status:l,system:d}=(0,a.useMemo)(()=>{var e;return null!==(e=n.find(e=>e.hash===t))&&void 0!==e?e:n[0]},[n,t]).params,c=(0,a.useMemo)(()=>l.includes(i.LL.MONITORED),[l]);return{filterTabs:n,activeTab:t,onTabChange:s,activeParams:(0,a.useMemo)(()=>e?{diff_status:l,system:d}:{diff_status:l},[e,l,d]),actionsDisabled:c}}},78238:function(e,t,s){"use strict";s.d(t,{g:function(){return n}});let n=["essential","functional.service.improve","personalize","analytics","marketing.advertising.first_party.targeted","marketing.advertising.third_party.targeted"];t.Z=e=>n.includes(e)},56514:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Y}});var n=s(24246),r=s(86677),a=s(27378),o=s(35287),i=s(77830),l=s(58754),d=s(59003),c=s(92222),u=s(13577),g=s(83766),m=s.n(g),h=s(812),v=s(47935),y=s(46628),p=s(73825),f=s(30952),x=s(37059),j=s(8133),_=s(79283),w=s(34929),b=s(78238),C=e=>{let{selectedTaxonomies:t,...s}=e,{getDataUseDisplayNameProps:r,getDataUses:a}=(0,w.Z)(),o=a().filter(e=>e.active&&b.g.includes(e.fides_key)).map(e=>{let{name:t,primaryName:s}=r(e.fides_key);return{value:e.fides_key,name:t,primaryName:s,description:e.description||""}});return(0,n.jsx)(_.l,{options:o,...s})};let{Text:k}=u.AntTypography;var S=e=>{let{onSave:t,isSaving:s,onClose:r,...o}=e,[i,l]=(0,a.useState)([]),d=()=>{l([]),r()};return(0,n.jsxs)(j.Z,{title:"Add consent category",...o,onClose:d,children:[(0,n.jsxs)(u.jqI,{vertical:!0,gap:20,className:"pb-6 pt-4",children:[(0,n.jsx)(k,{children:"Assign consent categories to selected assets. This configures the system for consent management. Consent categories apply to both individual assets and the system."}),(0,n.jsx)(C,{mode:"tags",selectedTaxonomies:i,onSelect:(e,t)=>l([...i,t.value]),variant:"outlined"})]}),(0,n.jsxs)(u.jqI,{justify:"space-between",children:[(0,n.jsx)(u.wpx,{htmlType:"reset",onClick:d,"data-testid":"cancel-btn",children:"Cancel"}),(0,n.jsx)(u.wpx,{htmlType:"submit",type:"primary",disabled:!i.length,loading:s,onClick:()=>{t(i),d()},"data-testid":"save-btn",children:"Save"})]})]})},T=s(29850),R=s(77685);let{Text:A}=u.AntTypography,I=e=>{let{onSave:t,isSaving:s,...r}=e,[o,i]=(0,a.useState)(),[l,d]=(0,a.useState)(!1),c=(0,a.useCallback)(e=>{e.preventDefault(),d(!0)},[]),g=()=>{d(!1)},m=()=>{i(void 0),r.onClose()};return(0,n.jsxs)(j.Z,{title:"Assign system",...r,onClose:m,children:[(0,n.jsxs)(u.jqI,{vertical:!0,gap:20,className:"pb-6 pt-4",children:[(0,n.jsx)(A,{children:"Assign a system to the selected assets. If no system exists, select 'Add new system' to create one."}),(0,n.jsx)(T.R,{placeholder:"Search or select...",onSelect:(e,t)=>{i(t)},onAddSystem:c,value:o})]})," ",(0,n.jsxs)(u.jqI,{justify:"space-between",children:[(0,n.jsx)(u.wpx,{htmlType:"reset",onClick:m,"data-testid":"cancel-btn",children:"Cancel"}),(0,n.jsx)(u.wpx,{htmlType:"submit",type:"primary",disabled:!o,loading:s,onClick:()=>{t(o),m()},"data-testid":"save-btn",children:"Save"})]}),l&&(0,n.jsx)(R.i,{isOpen:!0,onClose:g,onSuccessfulSubmit:(e,t)=>{g(),i({label:t,value:e})},toastOnSuccess:!0})]})};var D=s(8411);let{Paragraph:P,Text:L,Link:E}=u.AntTypography,M=e=>{var t,s,r;let{isOpen:o,stagedResource:i,status:l,onCancel:d,onDownload:c}=e,[g,m]=(0,a.useState)(1),[h,y]=(0,a.useState)(v.W3[0]),{data:p,isFetching:f,isError:j}=(0,x.mi)({stagedResourceUrn:i.urn,status:l,page:g,size:h}),{items:_,total:w}=(0,a.useMemo)(()=>p||{items:[],total:0,pages:0,filterOptions:{assigned_users:[],systems:[]}},[p]);return(0,n.jsx)(u.$zI,{title:"Consent discovery",width:768,open:o,onCancel:d,footer:[(0,n.jsx)(u.wpx,{onClick:d,children:"Cancel"},"cancel"),!!c&&(0,n.jsx)(u.wpx,{type:"primary",onClick:c,children:"Download"},"download")],"data-testid":"consent-breakdown-modal",children:(0,n.jsxs)(u.jqI,{vertical:!0,className:"gap-6","data-testid":"consent-breakdown-modal-content",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(P,{children:"View all instances where this asset was detected without consent, organized by location and page. Use this to investigate potential compliance issues."}),(0,n.jsxs)(P,{children:[(0,n.jsx)(L,{strong:!0,children:"Asset name:"})," ",null!==(t=i.name)&&void 0!==t?t:(0,n.jsx)(L,{italic:!0,children:"Unknown"}),","," ",(0,n.jsx)(L,{strong:!0,children:"System:"})," ",null!==(s=i.system)&&void 0!==s?s:(0,n.jsx)(L,{italic:!0,children:"Unassigned"}),","," ",(0,n.jsx)(L,{strong:!0,children:"Domain:"})," ",null!==(r=i.domain)&&void 0!==r?r:(0,n.jsx)(L,{italic:!0,children:"Unknown"})]})]}),j?(0,n.jsx)(u.DUx,{type:"error",message:"Error fetching data",description:"Please try again later.",showIcon:!0}):(0,n.jsx)(u.V5H,{columns:[{title:"Location",dataIndex:"location",key:"location",render:e=>{var t;return null!==(t=D.Z8[e])&&void 0!==t?t:e}},{title:"Page",dataIndex:"page",key:"page",render:e=>(0,n.jsx)(E,{href:e,target:"_blank",rel:"noopener noreferrer",children:e})}],dataSource:_,pagination:!!w&&(g>1||h>v.W3[0])&&{current:g,pageSize:h,total:w||0,showSizeChanger:!0,pageSizeOptions:v.W3,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items"),onChange:(e,t)=>{m(e),t!==h&&(y(t),m(1))}},loading:f,"data-testid":"consent-breakdown-modal-table"})]})})};var N=s(88708),O=s(62165),U=s(72625),Z=s(54762),z=s(9320);let V=e=>{let{asset:t,onTabChange:s}=e,[a,{isLoading:o}]=(0,x.EY)(),[l,{isLoading:d}]=(0,x.nS)(),[c,{isLoading:g}]=(0,x.Tj)(),m=(0,u.pmc)(),v=(0,r.useRouter)(),f=o||d||g,{urn:j,name:_,resource_type:w,diff_status:b,system_key:C,user_assigned_system_key:k}=t,S=async()=>{let e=await a({urnList:[j]});if((0,h.D4)(e))m((0,y.Vo)((0,h.e$)(e.error)));else{let e=k||C,t="".concat(i.So,"/configure/").concat(e,"#assets");m((0,y.t5)((0,z._)("".concat(w,' "').concat(_,'" has been added to the system inventory.'),e?()=>v.push(t):void 0)))}},T=async()=>{let e=await l({urnList:[j]});(0,h.D4)(e)?m((0,y.Vo)((0,h.e$)(e.error))):m((0,y.t5)((0,z._)("".concat(w,' "').concat(_,'" has been ignored and will not appear in future scans.'),()=>s(N.A.IGNORED))))},R=async()=>{let e=await c({urnList:[j]});(0,h.D4)(e)?m((0,y.Vo)((0,h.e$)(e.error))):m((0,y.t5)("".concat(w,' "').concat(_,'" is no longer ignored and will appear in future scans.')))};return(0,n.jsxs)(u.vyj,{children:[b!==p.LL.MUTED&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.esZ,{title:t.system?void 0:"This asset requires a system before you can add it to the inventory.",children:(0,n.jsx)(u.wpx,{"data-testid":"add-btn",size:"small",onClick:S,disabled:!t.system||f,loading:o,children:"Add"})}),(0,n.jsx)(u.wpx,{"data-testid":"ignore-btn",size:"small",onClick:T,disabled:f,loading:d,children:"Ignore"})]}),b===p.LL.MUTED&&(0,n.jsx)(u.wpx,{"data-testid":"restore-btn",size:"small",onClick:R,disabled:f,loading:g,children:"Restore"})]})};var q=s(14047),W=s(26183),$=s(31883),H=e=>{var t;let{asset:s,readonly:r}=e,[o,i]=(0,a.useState)(!1),[l]=(0,x.Ak)(),{successAlert:d,errorAlert:c}=(0,q.V)(),{getDataUseDisplayName:g}=(0,w.Z)(),m=s.user_assigned_data_uses||s.data_uses||[],v=async e=>{let t=await l({monitorId:s.monitor_config_id,urnList:[s.urn],dataUses:[...m,e]});(0,$.D4)(t)?c((0,h.e$)(t.error)):d("Consent category added to ".concat(s.resource_type,' "').concat(s.name,'" .'),"Confirmed"),i(!1)},y=async e=>{let t=await l({monitorId:s.monitor_config_id,urnList:[s.urn],dataUses:m.filter(t=>t!==e)});(0,$.D4)(t)?c((0,h.e$)(t.error)):d("Consent category removed from ".concat(s.resource_type,' "').concat(s.name,'".'),"Confirmed")},p=(null===(t=s.user_assigned_data_uses)||void 0===t?void 0:t.length)?s.user_assigned_data_uses:s.data_uses,f=null==p?void 0:p.filter(e=>(0,b.Z)(e));return r?(0,n.jsx)(W.Z,{children:null==f?void 0:f.map(e=>(0,n.jsx)(u.j8w,{color:"white",children:g(e)},e))}):(0,n.jsxs)(W.Z,{children:[!o&&(0,n.jsxs)(n.Fragment,{children:[null==f?void 0:f.map(e=>(0,n.jsx)(u.j8w,{"data-testid":"data-use-".concat(e),color:"white",closable:!0,onClose:()=>y(e),closeButtonLabel:"Remove data use",children:g(e)},e)),(0,n.jsx)(u.j8w,{onClick:()=>i(!0),"data-testid":"taxonomy-add-btn",addable:!0,"aria-label":"Add data use"})]}),o&&(0,n.jsx)(u.xuv,{className:"select-wrapper",position:"absolute",zIndex:10,top:"0",left:"0",width:"100%",height:"max",bgColor:"#fff",children:(0,n.jsx)(C,{selectedTaxonomies:f||[],onSelect:v,onBlur:()=>i(!1),open:!0})})]})};let B=e=>{let{consentAggregated:t,stagedResource:s,onShowBreakdown:r}=e;return(0,n.jsxs)(n.Fragment,{children:[t===p.lg.WITHOUT_CONSENT&&(0,n.jsx)(u.esZ,{title:"Asset was detected before the user gave consent or without any consent. Click the info icon for more details.",children:(0,n.jsx)(u.j8w,{color:"error",closeIcon:(0,n.jsx)(u.PJP.daM,{style:{width:12,height:12}}),closeButtonLabel:"View details",onClose:()=>{null==r||r(s,t)},"data-testid":"status-badge_without-consent",children:"Without consent"})}),t===p.lg.WITH_CONSENT&&(0,n.jsx)(u.esZ,{title:"Asset was detected after the user gave consent",children:(0,n.jsx)(u.j8w,{color:"success","data-testid":"status-badge_with-consent",children:"With consent"})}),t===p.lg.EXEMPT&&(0,n.jsx)(u.esZ,{title:"Asset is valid regardless of consent",children:(0,n.jsx)(u.j8w,{"data-testid":"status-badge_consent-exempt",children:"Consent exempt"})}),t===p.lg.UNKNOWN&&(0,n.jsx)(u.esZ,{title:"Did not find consent information for this asset. You may need to re-run the monitor.",children:(0,n.jsx)(u.j8w,{"data-testid":"status-badge_unknown",children:"Unknown"})})]})};var K=s(43862),F=s(70675);let J=e=>{let{aggregateSystem:t,monitorConfigId:s,readonly:r}=e,{resource_type:o,name:i,urn:l,system:d,user_assigned_system_key:c,system_key:g}=t,[m,v]=(0,a.useState)(!1),[y,p]=(0,a.useState)(!1),[f,{isLoading:x}]=(0,F.NA)(),{successAlert:j,errorAlert:_}=(0,q.V)(),w=(0,a.useCallback)(e=>{e.preventDefault(),p(!0)},[]),b=async(e,t,n)=>{let r=await f({staged_resource_urn:l,monitor_config_id:s,user_assigned_system_key:e});(0,h.D4)(r)?_((0,h.e$)(r.error)):j(n?"".concat(t," has been added to your system inventory and the ").concat(o,' "').concat(i,'" has been assigned to that system.'):"".concat(o,' "').concat(i,'" has been assigned to ').concat(t,"."),"Confirmed"),v(!1)};return r?(0,n.jsx)("div",{style:(0,K.J9)(),children:(0,n.jsx)(u.j8w,{"data-testid":"system-badge",color:"white",children:d})}):(0,n.jsxs)(n.Fragment,{children:[!m&&(0,n.jsx)("div",{style:(0,K.J9)(),children:d?(0,n.jsxs)(u.j8w,{onClick:()=>v(!0),"data-testid":"system-badge",children:[d,(0,n.jsx)(u.PJP.I8b,{})]}):(0,n.jsx)(u.j8w,{onClick:()=>v(!0),"data-testid":"add-system-btn",addable:!0})}),!!m&&(0,n.jsx)(T.R,{variant:"borderless",className:"w-full",autoFocus:!0,defaultOpen:!0,defaultValue:c||g,onBlur:e=>{var t;(null===(t=e.relatedTarget)||void 0===t?void 0:t.getAttribute("id"))!=="add-new-system"&&v(!1)},onAddSystem:w,onSelect:(e,t)=>b(e,t.label),loading:x}),y&&(0,n.jsx)(R.i,{isOpen:!0,onClose:()=>{p(!1)},onSuccessfulSubmit:(e,t)=>b(e,t,!0)})]})},G=e=>{let{readonly:t,aggregatedConsent:s,onTabChange:r,onShowBreakdown:o}=e,{flags:i}=(0,O.hz)(),{assetConsentStatusLabels:l}=i;return{columns:(0,a.useMemo)(()=>{let e=(0,c.Cl)(),a=[e.accessor(e=>e.name,{id:"name",cell:e=>(0,n.jsx)(v.G3,{value:e.getValue()}),header:"Asset",size:300,meta:{headerProps:t?void 0:{paddingLeft:"0px"},cellProps:t?void 0:{padding:"0 !important"}}}),e.accessor(e=>e.resource_type,{id:"resource_type",cell:e=>(0,n.jsx)(v.G3,{value:e.getValue()}),header:"Type"}),e.accessor(e=>e.system,{id:"system",cell:e=>!!e.row.original.monitor_config_id&&(0,n.jsx)(J,{aggregateSystem:e.row.original,monitorConfigId:e.row.original.monitor_config_id,readonly:t}),header:"System",size:200,meta:{noPadding:!0}}),e.display({id:"data_use",cell:e=>(0,n.jsx)(H,{asset:e.row.original,readonly:t}),header:"Categories of consent",size:400,meta:{disableRowClick:!0}}),e.accessor(e=>e.locations,{id:"locations",cell:e=>(0,n.jsx)(U.mb,{values:e.getValue().map(e=>{var t;return{label:null!==(t=D.Z8[e])&&void 0!==t?t:e,key:e}}),cellProps:e}),header:e=>(0,n.jsx)(U.Rr,{value:"Locations",...e}),size:300,meta:{showHeaderMenu:!0,disableRowClick:!0}}),e.accessor(e=>e.domain,{id:"domain",cell:e=>(0,n.jsx)(v.G3,{value:e.getValue()}),header:e=>(0,n.jsx)(U.Rr,{value:"Domain",...e})}),e.accessor(e=>e.consent_aggregated,{id:"consent_aggregated",cell:e=>{var t;return(0,n.jsx)(B,{consentAggregated:null!==(t=e.getValue())&&void 0!==t?t:p.lg.UNKNOWN,stagedResource:e.row.original,onShowBreakdown:o})},header:()=>(0,n.jsxs)(u.vyj,{children:[(0,n.jsx)("div",{children:"Discovery"}),s===p.lg.WITHOUT_CONSENT&&(0,n.jsx)(Z.l,{consentStatus:{status:p.pF.ALERT,message:"One or more assets were detected without consent"}})]})}),e.accessor(e=>e.page,{id:"page",cell:e=>(0,n.jsx)(U.tc,{values:e.getValue(),valueSuffix:"pages",cellProps:e}),header:e=>(0,n.jsx)(U.Rr,{value:"Detected on",...e}),meta:{showHeaderMenu:!0,disableRowClick:!0}})],i=l?a:a.filter(e=>"consent_aggregated"!==e.id);return t?i:[e.display({id:"select",cell:e=>{let{row:t}=e;return(0,n.jsx)(v.k,{isChecked:t.getIsSelected(),onChange:t.getToggleSelectedHandler(),dataTestId:"select-".concat(t.original.name||t.id)})},header:e=>{let{table:t}=e;return(0,n.jsx)(v.k,{isChecked:t.getIsAllPageRowsSelected(),isIndeterminate:t.getIsSomeRowsSelected(),onChange:t.getToggleAllRowsSelectedHandler(),dataTestId:"select-all-rows"})},maxSize:40,meta:{cellProps:{borderRight:"none"}}}),...i,e.display({id:"actions",cell:e=>(0,n.jsx)(V,{asset:e.row.original,onTabChange:r}),header:"Actions",meta:{disableRowClick:!0}})]},[t,l,s,r,o])}},X=e=>{var t;let{monitorId:s,systemId:o,onSystemName:l}=e,g=(0,r.useRouter)(),[j,_]=(0,a.useState)(),[w,b]=(0,a.useState)(o),[C,k]=(0,a.useState)({}),[T,R]=(0,a.useState)(!1),[A,D]=(0,a.useState)(!1),[P,L]=(0,a.useState)(null),[E,{isLoading:O}]=(0,x.EY)(),[U,{isLoading:Z}]=(0,x.nS)(),[V,{isLoading:q}]=(0,x.rs)(),[W,{isLoading:$}]=(0,x.sX)(),[H,{isLoading:B}]=(0,x.Vr)(),[K,{isLoading:F}]=(0,x.Tj)(),J=O||Z||q||$||F,X=J||o===i.Kl,{PAGE_SIZES:Y,pageSize:Q,setPageSize:ee,onPreviousPageClick:et,isPreviousPageDisabled:es,onNextPageClick:en,isNextPageDisabled:er,startRange:ea,endRange:eo,pageIndex:ei,setTotalPages:el,resetPageIndexToDefault:ed}=(0,v.oi)(),[ec,eu]=(0,a.useState)(""),eg=(0,u.pmc)();(0,a.useEffect)(()=>{ed()},[s,ec,ed]);let{filterTabs:em,activeTab:eh,onTabChange:ev,activeParams:ey,actionsDisabled:ep}=(0,N.Z)(o);(0,a.useEffect)(()=>{ed()},[s,ec,eh,ed]);let{data:ef,isLoading:ex,isFetching:ej}=(0,x.WJ)({key:s,page:ei,size:Q,search:ec,...ey});(0,a.useEffect)(()=>{if(ef){var e,t;let s=(null===(e=ef.items[0])||void 0===e?void 0:e.system)||w||o||"";el(null!==(t=ef.pages)&&void 0!==t?t:1),b(s),null==l||l(s)}},[ef,o,l,el,w]),(0,a.useEffect)(()=>{if((null==ef?void 0:ef.items)&&!j){var e;_(null===(e=ef.items.find(e=>e.consent_aggregated===p.lg.WITHOUT_CONSENT))||void 0===e?void 0:e.consent_aggregated)}},[ef,j]);let{columns:e_}=G({readonly:null!=ep&&ep,onTabChange:ev,aggregatedConsent:j,onShowBreakdown:(e,t)=>{L({stagedResource:e,status:t})}}),ew=(0,d.b7)({getCoreRowModel:(0,c.sC)(),columns:e_,manualPagination:!0,data:(null==ef?void 0:ef.items)||[],columnResizeMode:"onChange",onRowSelectionChange:k,getRowId:e=>e.urn,state:{rowSelection:C}}),eb=ew.getSelectedRowModel().rows.map(e=>e.original.urn),eC=async()=>{var e,t,s;let n=await E({urnList:eb}),r=null!==(s=null==ef?void 0:ef.items.filter(e=>eb.includes(e.urn)))&&void 0!==s?s:[],a=(null===(e=r[0])||void 0===e?void 0:e.user_assigned_system_key)||(null===(t=r[0])||void 0===t?void 0:t.system_key),o=r.every(e=>(e.user_assigned_system_key||e.system_key)===a)?a:void 0;(0,h.D4)(n)?eg((0,y.Vo)((0,h.e$)(n.error))):(ew.resetRowSelection(),eg((0,y.t5)((0,z._)("".concat(eb.length," assets from ").concat(w," have been added to the system inventory."),o?()=>g.push("".concat(i.So,"/configure/").concat(o,"#assets")):()=>g.push(i.So)))))},ek=async e=>{if("string"==typeof(null==e?void 0:e.value)){let t=await W({monitorId:s,urnList:eb,systemKey:e.value});(0,h.D4)(t)?eg((0,y.Vo)((0,h.e$)(t.error))):eg((0,y.t5)("".concat(eb.length," assets have been assigned to ").concat(e.label,"."),"Confirmed"))}R(!1)},eS=async e=>{let t=null==ef?void 0:ef.items.filter(e=>eb.includes(e.urn));if(!t)return;let n=t.map(t=>{let s=m()([...t.user_assigned_data_uses||t.data_uses||[],...e]);return{urn:t.urn,user_assigned_data_uses:s}}),r=await H({monitorId:s,assets:n});(0,h.D4)(r)?eg((0,y.Vo)((0,h.e$)(r.error))):eg((0,y.t5)("Consent categories added to ".concat(eb.length," assets").concat(w?" from ".concat(w):"","."),"Confirmed")),D(!1)},eT=async()=>{let e=await U({urnList:eb});(0,h.D4)(e)?eg((0,y.Vo)((0,h.e$)(e.error))):(ew.resetRowSelection(),eg((0,y.t5)(w===i.Kl?"".concat(eb.length," uncategorized assets have been ignored and will not appear in future scans."):"".concat(eb.length," assets from ").concat(w," have been ignored and will not appear in future scans."),"Confirmed")))},eR=async()=>{let e=await K({urnList:eb});(0,h.D4)(e)?eg((0,y.Vo)((0,h.e$)(e.error))):(ew.resetRowSelection(),eg((0,y.t5)("".concat(eb.length," assets have been restored and will appear in future scans."),"Confirmed")))},eA=async()=>{let e=(null==ef?void 0:ef.items.length)||0,t=await V({monitor_config_key:s,resolved_system_ids:[o]});(0,h.D4)(t)?eg((0,y.Vo)((0,h.e$)(t.error))):(g.push("".concat(i.vi,"/").concat(s)),eg((0,y.t5)("".concat(e," assets from ").concat(w," have been added to the system inventory."),"Confirmed")))},eI=e=>{ev(e),k({})};return s&&o?ex?(0,n.jsx)(v.I4,{rowHeight:36,numRows:36}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.A5g,{items:em.map(e=>({key:e.hash,label:e.label})),activeKey:eh,onChange:e=>eI(e)}),(0,n.jsxs)(v.Q$,{children:[(0,n.jsx)(f.f,{value:ec,onChange:eu,placeholder:"Search by asset name..."}),(0,n.jsxs)(u.kCb,{alignItems:"center",children:[!!eb.length&&(0,n.jsx)(u.xvT,{fontSize:"xs",fontWeight:"semibold",minW:16,mr:6,"data-testid":"selected-count",children:"".concat(eb.length," selected")}),(0,n.jsxs)(u.Ugi,{children:[(0,n.jsx)(u.S0p,{menu:{items:[{key:"add",label:"Add",onClick:eC},{key:"add-data-use",label:"Add consent category",onClick:()=>D(!0)},{key:"assign-system",label:"Assign system",onClick:()=>R(!0)},...(null==ey?void 0:null===(t=ey.diff_status)||void 0===t?void 0:t.includes(p.LL.MUTED))?[{key:"restore",label:"Restore",onClick:eR}]:[{type:"divider"},{key:"ignore",label:"Ignore",onClick:eT}]]},trigger:["click"],children:(0,n.jsx)(u.wpx,{icon:(0,n.jsx)(u.PJP._ME,{}),iconPosition:"end",loading:J,"data-testid":"bulk-actions-menu",disabled:!eb.length||J||ep,type:"primary",children:"Actions"})}),(0,n.jsx)(u.esZ,{title:X?"These assets require a system before you can add them to the inventory.":void 0,children:(0,n.jsx)(u.wpx,{onClick:eA,disabled:X,loading:q,type:"primary",icon:(0,n.jsx)(u.PJP.MCw,{}),iconPosition:"end","data-testid":"add-all",children:"Add all"})})]})]})]}),(0,n.jsx)(v.ZK,{tableInstance:ew,emptyTableNotice:(0,n.jsx)(u.oj8,{image:u.oj8.PRESENTED_IMAGE_SIMPLE,description:"All caught up!"})}),(0,n.jsx)(v.s8,{totalRows:(null==ef?void 0:ef.total)||0,pageSizes:Y,setPageSize:ee,onPreviousPageClick:et,isPreviousPageDisabled:es||ej,onNextPageClick:en,isNextPageDisabled:er||ej,startRange:ea,endRange:eo}),(0,n.jsx)(I,{isOpen:T,onClose:()=>{R(!1)},onSave:ek,isSaving:$}),(0,n.jsx)(S,{isOpen:A,onClose:()=>{D(!1)},onSave:eS,isSaving:B}),P&&(0,n.jsx)(M,{isOpen:!!P,stagedResource:P.stagedResource,status:P.status,onCancel:()=>{L(null)}})]}):null};var Y=()=>{let e=(0,r.useRouter)(),t=decodeURIComponent(e.query.monitorId),s=decodeURIComponent(e.query.systemId),[d,c]=(0,a.useState)(s===i.Kl?"Uncategorized assets":s);return(0,n.jsxs)(o.Z,{title:"Action center - Discovered assets",children:[(0,n.jsx)(l.Z,{heading:"Action center",breadcrumbItems:[{title:"All activity",href:i.vi},{title:t,href:"".concat(i.vi,"/").concat(t)},{title:s===i.Kl?"Uncategorized assets":d}]}),(0,n.jsx)(X,{monitorId:t,systemId:s,onSystemName:c})]})}},31883:function(e,t,s){"use strict";s.d(t,{Bw:function(){return n.Bw},D4:function(){return n.D4}});var n=s(19043)}},function(e){e.O(0,[2858,2866,9278,409,401,6780,2888,9774,179],function(){return e(e.s=25654)}),_N_E=e.O()}]);